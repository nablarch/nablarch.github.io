


<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv='content-language' content='ja'>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Micrometer Adapter &mdash; ∇Nablarch  5u18 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  

  

  
  <link rel="canonical" href="https://nablarch.github.io/docs/LATEST/doc/application_framework/adaptors/micrometer_adaptor.html" />
  
    <link rel="top" title="∇Nablarch  5u18 documentation" href="../../index.html"/>
        <link rel="up" title="Adaptor" href="index.html"/>
        <link rel="next" title="Example" href="../example/index.html"/>
        <link rel="prev" title="SLF4J Adapter" href="slf4j_adaptor.html"/>
 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          
  
  <a href="../../index.html" id="sidebar-title" class="icon"> ∇Nablarch 
  

  
    <div id="sidebar-version">Version: 5u18</div>
  </a>

  <div role="search">
    <form id="google-search-form" class="wy-form" method="get" action="https://www.google.co.jp/search">
      <input type="text" name="text" placeholder="Search docs on google" id="text"/>
      <input type="hidden" name="q" id="q"/>
    </form>
  </div>
    
    

        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
  
  
    <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../about_nablarch/index.html">What is the Nablarch?</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../about_nablarch/concept.html">Nablarch Concept</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../about_nablarch/concept.html#robustness">Robustness</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../about_nablarch/concept.html#testability">Testability</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../about_nablarch/concept.html#ready-to-use">Ready-to-Use</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../about_nablarch/mvn_module.html">Module List of Nablarch</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../about_nablarch/license.html">Information on Nablarch License</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Nablarch Application Framework</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../application_framework/index.html">Application Framework</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../application_framework/nablarch/index.html">1. What is Nablarch Application Framework?</a></li>
<li class="toctree-l3"><a class="reference internal" href="../application_framework/web/index.html">2. Web Application</a></li>
<li class="toctree-l3"><a class="reference internal" href="../application_framework/web_service/index.html">3. Web Service</a></li>
<li class="toctree-l3"><a class="reference internal" href="../application_framework/batch/index.html">4. Batch Application</a></li>
<li class="toctree-l3"><a class="reference internal" href="../application_framework/messaging/index.html">5. Messaging</a></li>
<li class="toctree-l3"><a class="reference internal" href="../application_framework/handlers/index.html">6. Standard Handler Provided by Nablarch</a></li>
<li class="toctree-l3"><a class="reference internal" href="../application_framework/libraries/index.html">7. Libraries Provided by Nablarch</a></li>
<li class="toctree-l3"><a class="reference internal" href="../application_framework/blank_project/index.html">8. Blank Project</a></li>
<li class="toctree-l3"><a class="reference internal" href="../application_framework/setting_guide/index.html">9. Nablarch Application Framework Configuration Guide</a></li>
<li class="toctree-l3"><a class="reference internal" href="../application_framework/configuration/index.html">10. Default Configuration List</a></li>
<li class="toctree-l3"><a class="reference internal" href="../application_framework/cloud_native/index.html">11. Nablarch Cloud Native Support</a></li>
</ul>
</li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Adaptor</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="log_adaptor.html">log Adapter</a></li>
<li class="toctree-l3"><a class="reference internal" href="router_adaptor.html">Routing Adapter</a></li>
<li class="toctree-l3"><a class="reference internal" href="webspheremq_adaptor.html">IBM WebSphere MQ Adapter</a></li>
<li class="toctree-l3"><a class="reference internal" href="jaxrs_adaptor.html">JAX-RS Adapter</a></li>
<li class="toctree-l3"><a class="reference internal" href="doma_adaptor.html">Doma Adapter</a></li>
<li class="toctree-l3"><a class="reference internal" href="jsr310_adaptor.html">JSR310(Date and Time API)Adapter</a></li>
<li class="toctree-l3"><a class="reference internal" href="mail_sender_freemarker_adaptor.html">E-mail FreeMarker Adapter</a></li>
<li class="toctree-l3"><a class="reference internal" href="mail_sender_thymeleaf_adaptor.html">E-mail Thymeleaf Adapter</a></li>
<li class="toctree-l3"><a class="reference internal" href="mail_sender_velocity_adaptor.html">E-mail Velocity Adapter</a></li>
<li class="toctree-l3"><a class="reference internal" href="web_thymeleaf_adaptor.html">Web Application Thymeleaf Adapter</a></li>
<li class="toctree-l3"><a class="reference internal" href="lettuce_adaptor.html">Lettuce Adapter</a></li>
<li class="toctree-l3"><a class="reference internal" href="slf4j_adaptor.html">SLF4J Adapter</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="">Micrometer Adapter</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../example/index.html">Example</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../example/index.html#procedure-to-build-the-environment">Procedure to build the environment</a></li>
<li class="toctree-l3"><a class="reference internal" href="../example/index.html#application-execution-procedure">Application execution procedure</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../extension_components/index.html">Nablarch extension component</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../extension_components/report/index.html">1. Form library</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../extension_components/workflow/doc/index.html">2. Workflow library</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../extension_components/workflow/tool/index.html">3. Workflow definition data generation tool</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../extension_components/etl/index.html">4. ETL</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../extension_components/etl/etl_maven_plugin.html">5. ETL Maven plugin</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../development_tools/index.html">Nablarch development tools</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../development_tools/java_static_analysis/index.html">1. Efficient Java Static Checks</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../development_tools/java_static_analysis/index.html#conduct-syntax-check">1.1. Conduct syntax check</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../development_tools/java_static_analysis/index.html#unify-the-format">1.2. Unify the format</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../development_tools/java_static_analysis/index.html#check-if-unauthorized-apis-are-being-used">1.3. Check if unauthorized APIs are being used</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../development_tools/ui_dev/index.html">2. Front-end UI development platform for advanced users</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../development_tools/testing_framework/index.html">3. Testing framework</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../development_tools/testing_framework/guide/development_guide/05_UnitTestGuide/index.html">3.1. How to Execute Unit Tests</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../development_tools/testing_framework/guide/development_guide/06_TestFWGuide/index.html">3.2. How to Use the Automated Test Framework</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../development_tools/testing_framework/guide/development_guide/08_TestTools/index.html">3.3. Tools Used in the Programming Phase</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../development_tools/toolbox/index.html">4. Useful Tools When Developing Applications</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../development_tools/toolbox/JspStaticAnalysis/index.html">4.1. JSP Static Analysis Tool</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../development_tools/toolbox/SqlExecutor/SqlExecutor.html">4.2. Nablarch SQL Executor</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../development_tools/toolbox/JspVerifier/JspVerifier.html">4.3. Job Screen JSP Validation Tool</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../examples/index.html">Nablarch Implementation Examples</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../examples/01/index.html">Sample Password Encryption Function Using Database</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../examples/01/0101_PBKDF2PasswordEncryptor.html">Sample Password Encryption Function Using PBKDF2</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../examples/01/index.html#delivery-package">Delivery package</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../examples/01/index.html#summary">Summary</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../examples/01/index.html#structure">Structure</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../examples/01/index.html#how-to-use">How to Use</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../examples/02/index.html">Extended Validation Functions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../examples/02/index.html#delivery-package">Delivery package</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../examples/02/index.html#email-address-validation">Email address validation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../examples/02/index.html#validation-of-japan-telephone-numbers">Validation of Japan telephone numbers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../examples/02/index.html#code-value-validation">Code value validation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../examples/03/index.html">Display a List of Search Results</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../examples/03/index.html#delivery-package">Delivery package</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../examples/03/index.html#summary">Summary</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../examples/03/index.html#structure">Structure</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../examples/03/index.html#how-to-use">How to Use</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../examples/03/index.html#listsearchinfo-class">ListSearchInfo class</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../examples/03/index.html#listsearchresult-tag">listSearchResult tag</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../examples/03/index.html#sort-search-results">Sort search results</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../examples/03/index.html#how-to-implement-displaying-a-list-of-all-search-results-on-a-single-screen">How to implement displaying a list of all search results on a single screen</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../examples/03/index.html#how-to-implement-the-initial-display-of-search-results-with-the-default-search-conditions">How to implement the initial display of search results with the default search conditions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../examples/03/index.html#default-settings-for-the-search-result-list-display-function">Default settings for the search result list display function</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../examples/03/index.html#how-to-import-a-sample-implementation-tag-file-into-the-business-application">How to import a sample implementation (tag file) into the business application</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../examples/03/index.html#tag-reference">Tag Reference</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../examples/04/index.html">Extended Formatter Functions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../examples/04/0401_ExtendedDataFormatter.html">Data Formatter Expansion</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../examples/04/0402_ExtendedFieldType.html">Field Type Expansion in the Data Formatter Function</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../examples/05/index.html">Sample File Management Function Using Database</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../examples/05/index.html#summary">Summary</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../examples/05/index.html#delivery-package">Delivery package</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../examples/05/index.html#functions">Functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../examples/05/index.html#structure">Structure</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../examples/05/index.html#how-to-use">How to Use</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../examples/06/index.html">CAPTCHA Function Sample</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../examples/06/06_Captcha_guide.html">How to Incorporate the CAPTCHA Function</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../examples/06/index.html#delivery-package">Delivery package</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../examples/06/index.html#summary">Summary</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../examples/06/index.html#structure">Structure</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../examples/06/index.html#how-to-use">How to Use</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../examples/07/index.html">Sample UserAgent Information Acquisition Function</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../examples/07/index.html#summary">Summary</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../examples/07/index.html#structure">Structure</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../examples/07/index.html#description-of-configuration">Description of configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../examples/07/index.html#use-case">Use case</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../examples/08/index.html">Sample of HTML Email Send Function</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../examples/08/index.html#summary">Summary</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../examples/08/index.html#request">Request</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../examples/08/index.html#structure">Structure</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../examples/08/index.html#implementation-examples">Implementation examples</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../examples/09/index.html">How to Use a Sample to Send a Digitally Signed Email Using Bouncycastle</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../examples/09/index.html#environment-preparation">Environment preparation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../examples/09/index.html#structure-of-digitally-signed-email-send-function">Structure of digitally signed email send function</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../examples/09/index.html#preparation-of-configuration-file">Preparation of configuration file</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../examples/09/index.html#execution">Execution</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../examples/10/index.html">How to Use the Log Aggregation Sample</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../examples/10/index.html#list-of-samples-provided">List of samples provided</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../examples/11/index.html">Messaging Platform Test Simulator Sample</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../examples/11/index.html#uses">Uses</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../examples/11/index.html#features">Features</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../examples/11/index.html#request">Request</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../examples/11/index.html#how-to-use">How to use</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../examples/11/index.html#expansion-example">Expansion example</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../nablarch_api/index.html">Nablarch API</a></li>
</ul>

  

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">∇Nablarch </a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../index.html">Nablarch Application Framework</a> &raquo;</li>
      
          <li><a href="index.html">Adaptor</a> &raquo;</li>
      
    <li>Micrometer Adapter</li>
    <li class="wy-breadcrumbs-aside">
      <a href="https://github.com/nablarch" class="fa fa-github">GitHub</a>
    </li>
    <li class="wy-breadcrumbs-aside">
        <a href="https://nablarch.github.io/docs/LATEST/doc/index.html" class="ja">日本語</a>
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="micrometer-adapter">
<span id="micrometer-adaptor"></span><h1>Micrometer Adapter<a class="headerlink" href="#micrometer-adapter" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="table-of-contents">
<p class="topic-title first">Table of contents</p>
<ul class="simple">
<li><a class="reference internal" href="#module-list" id="id2">Module list</a></li>
<li><a class="reference internal" href="#setting-up-to-use-the-micrometer-adapter" id="id3">Setting up to use the Micrometer adapter</a><ul>
<li><a class="reference internal" href="#declare-the-defaultsmeterbinderlistprovider-as-a-component" id="id4">Declare the DefaultsMeterBinderListProvider as a component</a></li>
<li><a class="reference internal" href="#target-the-defaultsmeterbinderlistprovider-for-disposal" id="id5">Target the DefaultsMeterBinderListProvider for disposal</a></li>
<li><a class="reference internal" href="#declare-the-registry-s-factory-class-as-a-component" id="id6">Declare the registry&#8217;s factory class as a component</a></li>
<li><a class="reference internal" href="#creating-a-configuration-file" id="id7">Creating a configuration file</a></li>
<li><a class="reference internal" href="#execution-result" id="id8">Execution Result</a></li>
</ul>
</li>
<li><a class="reference internal" href="#registry-factory" id="id9">Registry factory</a></li>
<li><a class="reference internal" href="#configuration-file" id="id10">Configuration File</a><ul>
<li><a class="reference internal" href="#placement" id="id11">Placement</a></li>
<li><a class="reference internal" href="#format" id="id12">Format</a></li>
<li><a class="reference internal" href="#override-with-os-environment-variables-or-system-properties" id="id13">Override with OS environment variables or system properties</a></li>
<li><a class="reference internal" href="#changing-the-configuration-prefix" id="id14">Changing the configuration prefix</a></li>
<li><a class="reference internal" href="#changing-the-place-of-the-configuration-file" id="id15">Changing the place of the configuration file</a></li>
</ul>
</li>
<li><a class="reference internal" href="#metrics-collected-by-the-defaultmeterbinderlistprovider" id="id16">Metrics collected by the DefaultMeterBinderListProvider</a></li>
<li><a class="reference internal" href="#configuring-common-tags" id="id17">Configuring Common Tags</a></li>
<li><a class="reference internal" href="#working-with-monitoring-services" id="id18">Working with monitoring services</a><ul>
<li><a class="reference internal" href="#working-with-datadog" id="id19">Working with Datadog</a></li>
<li><a class="reference internal" href="#working-with-cloudwatch" id="id20">Working with CloudWatch</a></li>
<li><a class="reference internal" href="#working-with-datadog-using-statsd" id="id21">Working with Datadog using StatsD</a></li>
</ul>
</li>
</ul>
</div>
<p>Provides an adapter to perform metrics collection using <a class="reference external" href="https://micrometer.io/">Micrometer (external site)</a> .</p>
<p>This adapter can be used to do the following. This provides the advantage of easier operational monitoring of the application.</p>
<ul class="simple">
<li>Can collect application metrics such as JVM memory usage and CPU usage.</li>
<li>The collected metrics can be linked to monitoring services such as <a class="reference external" href="https://www.datadoghq.com/">Datadog (external site)</a> and <a class="reference external" href="https://aws.amazon.com/cloudwatch/">CloudWatch (external site)</a> .</li>
</ul>
<div class="section" id="module-list">
<h2><a class="toc-backref" href="#id2">Module list</a><a class="headerlink" href="#module-list" title="Permalink to this headline">¶</a></h2>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="c">&lt;!-- Micrometer adapter --&gt;</span>
<span class="nt">&lt;dependency&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>com.nablarch.integration<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>nablarch-micrometer-adaptor<span class="nt">&lt;/artifactId&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</pre></div>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">Tests are conducted using Micrometer version 1.5.4.
If you change the version, the project  should be tested to make sure it is working.</p>
</div>
</div>
<div class="section" id="setting-up-to-use-the-micrometer-adapter">
<h2><a class="toc-backref" href="#id3">Setting up to use the Micrometer adapter</a><a class="headerlink" href="#setting-up-to-use-the-micrometer-adapter" title="Permalink to this headline">¶</a></h2>
<p>In order to collect metrics in Micrometer, need to create a class called <a class="reference external" href="https://micrometer.io/docs/concepts#_registry">Registry (external site)</a> .
This adapter provides a <a class="reference external" href="https://nablarch.github.io/docs/LATEST/javadoc/nablarch/core/repository/di/ComponentFactory.html" title="nablarch.core.repository.di.ComponentFactory">ComponentFactory</a> to register this registry in the System Repository.</p>
<p>In this section,  describe how to set up <a class="reference external" href="https://nablarch.github.io/docs/LATEST/javadoc/nablarch/integration/micrometer/logging/LoggingMeterRegistryFactory.html" title="nablarch.integration.micrometer.logging.LoggingMeterRegistryFactory">LoggingMeterRegistryFactory</a> as an example, registering <a class="reference external" href="https://javadoc.io/doc/io.micrometer/micrometer-core/1.5.4/io/micrometer/core/instrument/logging/LoggingMeterRegistry.html">LoggingMeterRegistry (external site)</a> as a component.</p>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p><a class="reference external" href="https://javadoc.io/doc/io.micrometer/micrometer-core/1.5.4/io/micrometer/core/instrument/logging/LoggingMeterRegistry.html">LoggingMeterRegistry (external site)</a> provides the feature to log metrics using SLF4J or Java Util Logging.
When no specific configuration is made, metrics are output to standard output using Java Util Logging, which is useful for a quick behavior check.</p>
<p class="last">Other registries require a lot of work to prepare the services to be federated and to create an implementation to output the collected metrics.
For this reason, we have used <a class="reference external" href="https://javadoc.io/doc/io.micrometer/micrometer-core/1.5.4/io/micrometer/core/instrument/logging/LoggingMeterRegistry.html">LoggingMeterRegistry (external site)</a> , which is the easiest to behavior check.</p>
</div>
<p>In this example, use <a class="reference external" href="https://github.com/nablarch/nablarch-example-web">Web application Example (external site)</a> as the base application.</p>
<div class="section" id="declare-the-defaultsmeterbinderlistprovider-as-a-component">
<h3><a class="toc-backref" href="#id4">Declare the DefaultsMeterBinderListProvider as a component</a><a class="headerlink" href="#declare-the-defaultsmeterbinderlistprovider-as-a-component" title="Permalink to this headline">¶</a></h3>
<p>The Micrometer has an interface called <a class="reference external" href="https://javadoc.io/doc/io.micrometer/micrometer-core/1.5.4/io/micrometer/core/instrument/binder/MeterBinder.html">MeterBinder (external site)</a>  .</p>
<p>The collection of frequently used metrics, such as JVM memory usage and CPU usage, is provided in advance as a class that implements this interface.
(e.g., <a class="reference external" href="https://javadoc.io/doc/io.micrometer/micrometer-core/1.5.4/io/micrometer/core/instrument/binder/jvm/JvmMemoryMetrics.html">JvmMemoryMetrics (external site)</a> for JVM memory usage and <a class="reference external" href="https://javadoc.io/doc/io.micrometer/micrometer-core/1.5.4/io/micrometer/core/instrument/binder/system/ProcessorMetrics.html">ProcessorMetrics (external site)</a> for CPU usage)</p>
<p><a class="reference external" href="https://nablarch.github.io/docs/LATEST/javadoc/nablarch/integration/micrometer/DefaultMeterBinderListProvider.html" title="nablarch.integration.micrometer.DefaultMeterBinderListProvider">DefaultMeterBinderListProvider</a> is a class that provides this <a class="reference external" href="https://javadoc.io/doc/io.micrometer/micrometer-core/1.5.4/io/micrometer/core/instrument/binder/MeterBinder.html">MeterBinder (external site)</a> list , which can be used to collect metrics such as JVM memory usage and CPU usage.</p>
<p>First, add this <a class="reference external" href="https://nablarch.github.io/docs/LATEST/javadoc/nablarch/integration/micrometer/DefaultMeterBinderListProvider.html" title="nablarch.integration.micrometer.DefaultMeterBinderListProvider">DefaultMeterBinderListProvider</a> declaration to <code class="docutils literal"><span class="pre">src/main/resources/web-component-configuration.xml</span></code> .</p>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;component</span> <span class="na">name=</span><span class="s">&quot;meterBinderListProvider&quot;</span>
           <span class="na">class=</span><span class="s">&quot;nablarch.integration.micrometer.DefaultMeterBinderListProvider&quot;</span> <span class="nt">/&gt;</span>
</pre></div>
</div>
<p>For a specific description of the metrics that are collected, see <a class="reference internal" href="#micrometer-default-metrics"><span>Metrics collected by the DefaultMeterBinderListProvider</span></a> .</p>
</div>
<div class="section" id="target-the-defaultsmeterbinderlistprovider-for-disposal">
<h3><a class="toc-backref" href="#id5">Target the DefaultsMeterBinderListProvider for disposal</a><a class="headerlink" href="#target-the-defaultsmeterbinderlistprovider-for-disposal" title="Permalink to this headline">¶</a></h3>
<p>Because the <a class="reference external" href="https://nablarch.github.io/docs/LATEST/javadoc/nablarch/integration/micrometer/DefaultMeterBinderListProvider.html" title="nablarch.integration.micrometer.DefaultMeterBinderListProvider">DefaultMeterBinderListProvider</a> is a component that needs to be disposed of, declare it for disposal as follows.</p>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;component</span> <span class="na">name=</span><span class="s">&quot;disposer&quot;</span>
    <span class="na">class=</span><span class="s">&quot;nablarch.core.repository.disposal.BasicApplicationDisposer&quot;</span><span class="nt">&gt;</span>

  <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;disposableList&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;list&gt;</span>
      <span class="nt">&lt;component-ref</span> <span class="na">name=</span><span class="s">&quot;meterBinderListProvider&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/list&gt;</span>
  <span class="nt">&lt;/property&gt;</span>

<span class="nt">&lt;/component&gt;</span>
</pre></div>
</div>
<p>For the object disposal process, see <a class="reference internal" href="../application_framework/libraries/repository.html#repository-dispose-object"><span>Handling the disposal of objects</span></a> .</p>
</div>
<div class="section" id="declare-the-registry-s-factory-class-as-a-component">
<h3><a class="toc-backref" href="#id6">Declare the registry&#8217;s factory class as a component</a><a class="headerlink" href="#declare-the-registry-s-factory-class-as-a-component" title="Permalink to this headline">¶</a></h3>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;component</span> <span class="na">class=</span><span class="s">&quot;nablarch.integration.micrometer.logging.LoggingMeterRegistryFactory&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;meterBinderListProvider&quot;</span> <span class="na">ref=</span><span class="s">&quot;meterBinderListProvider&quot;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;applicationDisposer&quot;</span> <span class="na">ref=</span><span class="s">&quot;disposer&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/component&gt;</span>
</pre></div>
</div>
<p>Next, declare the factory class as a component, which is provided for each registry to be used.</p>
<p>In doing so, configure two properties, <code class="docutils literal"><span class="pre">meterBinderListProvider</span></code> and <code class="docutils literal"><span class="pre">applicationDisposer</span></code> .
For each property, configure <a class="reference external" href="https://nablarch.github.io/docs/LATEST/javadoc/nablarch/integration/micrometer/DefaultMeterBinderListProvider.html" title="nablarch.integration.micrometer.DefaultMeterBinderListProvider">DefaultMeterBinderListProvider</a> and <a class="reference external" href="https://nablarch.github.io/docs/LATEST/javadoc/nablarch/core/repository/disposal/BasicApplicationDisposer.html" title="nablarch.core.repository.disposal.BasicApplicationDisposer">BasicApplicationDisposer</a> as declared above.</p>
<p>The factory classes provided by this adapter are listed in <a class="reference internal" href="#micrometer-registry-factory"><span>Registry factory</span></a> .</p>
</div>
<div class="section" id="creating-a-configuration-file">
<h3><a class="toc-backref" href="#id7">Creating a configuration file</a><a class="headerlink" href="#creating-a-configuration-file" title="Permalink to this headline">¶</a></h3>
<p>Finally, create a text file named <code class="docutils literal"><span class="pre">micrometer.properties</span></code> under <code class="docutils literal"><span class="pre">src/main/resources</span></code> .</p>
<p>Describe the contents as follows.</p>
<div class="highlight-properties"><div class="highlight"><pre><span></span><span class="c"># Output metrics every 5 seconds</span>
<span class="na">nablarch.micrometer.logging.step</span><span class="o">=</span><span class="s">5s</span>
</pre></div>
</div>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last"><code class="docutils literal"><span class="pre">micrometer.properties</span></code> must be placed even if the content is empty.</p>
</div>
</div>
<div class="section" id="execution-result">
<span id="micrometer-metrics-output-example"></span><h3><a class="toc-backref" href="#id8">Execution Result</a><a class="headerlink" href="#execution-result" title="Permalink to this headline">¶</a></h3>
<p>Now you can collect metrics using the <code class="docutils literal"><span class="pre">LoggingMeterRegistry</span></code> .</p>
<p>Launching the application, can see that the collected metrics are output to standard output as follows</p>
<div class="highlight-text"><div class="highlight"><pre><span></span>2020-09-04 15:33:40.689 [INFO ]      i.m.c.i.l.LoggingMeterRegistry: jvm.gc.count{memory.manager.name=PS Scavenge} throughput=2.6/s
2020-09-04 15:33:40.690 [INFO ]      i.m.c.i.l.LoggingMeterRegistry: jvm.gc.count{memory.manager.name=PS MarkSweep} throughput=0.4/s
2020-09-04 15:33:40.691 [INFO ]      i.m.c.i.l.LoggingMeterRegistry: jvm.buffer.count{id=mapped} value=0 buffers
2020-09-04 15:33:40.691 [INFO ]      i.m.c.i.l.LoggingMeterRegistry: jvm.buffer.count{id=direct} value=2 buffers
2020-09-04 15:33:40.692 [INFO ]      i.m.c.i.l.LoggingMeterRegistry: jvm.buffer.memory.used{id=direct} value=124 KiB
2020-09-04 15:33:40.692 [INFO ]      i.m.c.i.l.LoggingMeterRegistry: jvm.buffer.memory.used{id=mapped} value=0 B
2020-09-04 15:33:40.692 [INFO ]      i.m.c.i.l.LoggingMeterRegistry: jvm.buffer.total.capacity{id=mapped} value=0 B
2020-09-04 15:33:40.692 [INFO ]      i.m.c.i.l.LoggingMeterRegistry: jvm.buffer.total.capacity{id=direct} value=124 KiB
2020-09-04 15:33:40.693 [INFO ]      i.m.c.i.l.LoggingMeterRegistry: jvm.classes.loaded{} value=9932 classes
2020-09-04 15:33:40.693 [INFO ]      i.m.c.i.l.LoggingMeterRegistry: jvm.gc.live.data.size{} value=0 B
2020-09-04 15:33:40.693 [INFO ]      i.m.c.i.l.LoggingMeterRegistry: jvm.gc.max.data.size{} value=2.65918 GiB
2020-09-04 15:33:40.694 [INFO ]      i.m.c.i.l.LoggingMeterRegistry: jvm.memory.committed{area=heap,id=PS Old Gen} value=182.5 MiB
2020-09-04 15:33:40.694 [INFO ]      i.m.c.i.l.LoggingMeterRegistry: jvm.memory.committed{area=heap,id=PS Survivor Space} value=44 MiB
2020-09-04 15:33:40.694 [INFO ]      i.m.c.i.l.LoggingMeterRegistry: jvm.memory.committed{area=heap,id=PS Eden Space} value=197 MiB
2020-09-04 15:33:40.694 [INFO ]      i.m.c.i.l.LoggingMeterRegistry: jvm.memory.committed{area=nonheap,id=Code Cache} value=29.125 MiB
2020-09-04 15:33:40.694 [INFO ]      i.m.c.i.l.LoggingMeterRegistry: jvm.memory.committed{area=nonheap,id=Compressed Class Space} value=6.796875 MiB
2020-09-04 15:33:40.695 [INFO ]      i.m.c.i.l.LoggingMeterRegistry: jvm.memory.committed{area=nonheap,id=Metaspace} value=55.789062 MiB
2020-09-04 15:33:40.695 [INFO ]      i.m.c.i.l.LoggingMeterRegistry: jvm.memory.max{area=heap,id=PS Old Gen} value=2.65918 GiB
2020-09-04 15:33:40.695 [INFO ]      i.m.c.i.l.LoggingMeterRegistry: jvm.memory.max{area=heap,id=PS Survivor Space} value=44 MiB
2020-09-04 15:33:40.696 [INFO ]      i.m.c.i.l.LoggingMeterRegistry: jvm.memory.max{area=nonheap,id=Code Cache} value=240 MiB
2020-09-04 15:33:40.696 [INFO ]      i.m.c.i.l.LoggingMeterRegistry: jvm.memory.max{area=nonheap,id=Metaspace} value=-1 B
2020-09-04 15:33:40.696 [INFO ]      i.m.c.i.l.LoggingMeterRegistry: jvm.memory.max{area=heap,id=PS Eden Space} value=1.243652 GiB
2020-09-04 15:33:40.696 [INFO ]      i.m.c.i.l.LoggingMeterRegistry: jvm.memory.max{area=nonheap,id=Compressed Class Space} value=1 GiB
2020-09-04 15:33:40.697 [INFO ]      i.m.c.i.l.LoggingMeterRegistry: jvm.memory.used{area=nonheap,id=Code Cache} value=28.618713 MiB
2020-09-04 15:33:40.697 [INFO ]      i.m.c.i.l.LoggingMeterRegistry: jvm.memory.used{area=nonheap,id=Compressed Class Space} value=6.270714 MiB
2020-09-04 15:33:40.697 [INFO ]      i.m.c.i.l.LoggingMeterRegistry: jvm.memory.used{area=nonheap,id=Metaspace} value=54.118324 MiB
2020-09-04 15:33:40.698 [INFO ]      i.m.c.i.l.LoggingMeterRegistry: jvm.memory.used{area=heap,id=PS Old Gen} value=69.320663 MiB
2020-09-04 15:33:40.698 [INFO ]      i.m.c.i.l.LoggingMeterRegistry: jvm.memory.used{area=heap,id=PS Survivor Space} value=7.926674 MiB
2020-09-04 15:33:40.698 [INFO ]      i.m.c.i.l.LoggingMeterRegistry: jvm.memory.used{area=heap,id=PS Eden Space} value=171.750542 MiB
2020-09-04 15:33:40.698 [INFO ]      i.m.c.i.l.LoggingMeterRegistry: jvm.threads.daemon{} value=28 threads
2020-09-04 15:33:40.698 [INFO ]      i.m.c.i.l.LoggingMeterRegistry: jvm.threads.live{} value=29 threads
2020-09-04 15:33:40.699 [INFO ]      i.m.c.i.l.LoggingMeterRegistry: jvm.threads.peak{} value=31 threads
2020-09-04 15:33:40.702 [INFO ]      i.m.c.i.l.LoggingMeterRegistry: jvm.threads.states{state=blocked} value=0 threads
2020-09-04 15:33:40.703 [INFO ]      i.m.c.i.l.LoggingMeterRegistry: jvm.threads.states{state=runnable} value=9 threads
2020-09-04 15:33:40.703 [INFO ]      i.m.c.i.l.LoggingMeterRegistry: jvm.threads.states{state=new} value=0 threads
2020-09-04 15:33:40.703 [INFO ]      i.m.c.i.l.LoggingMeterRegistry: jvm.threads.states{state=timed-waiting} value=3 threads
2020-09-04 15:33:40.703 [INFO ]      i.m.c.i.l.LoggingMeterRegistry: jvm.threads.states{state=terminated} value=0 threads
2020-09-04 15:33:40.704 [INFO ]      i.m.c.i.l.LoggingMeterRegistry: jvm.threads.states{state=waiting} value=17 threads
2020-09-04 15:33:41.199 [INFO ]      i.m.c.i.l.LoggingMeterRegistry: process.cpu.usage{} value=0.111672
2020-09-04 15:33:41.199 [INFO ]      i.m.c.i.l.LoggingMeterRegistry: process.start.time{} value=444222h 33m 14.544s
2020-09-04 15:33:41.199 [INFO ]      i.m.c.i.l.LoggingMeterRegistry: process.uptime{} value=26.729s
2020-09-04 15:33:41.200 [INFO ]      i.m.c.i.l.LoggingMeterRegistry: system.cpu.count{} value=8
2020-09-04 15:33:41.200 [INFO ]      i.m.c.i.l.LoggingMeterRegistry: system.cpu.usage{} value=0.394545
</pre></div>
</div>
</div>
</div>
<div class="section" id="registry-factory">
<span id="micrometer-registry-factory"></span><h2><a class="toc-backref" href="#id9">Registry factory</a><a class="headerlink" href="#registry-factory" title="Permalink to this headline">¶</a></h2>
<p>This adapter provides the following registry factory classes.</p>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="33%" />
<col width="33%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Registry</td>
<td>Factory class</td>
<td>The version of the adapter being provided</td>
</tr>
<tr class="row-even"><td><a class="reference external" href="https://javadoc.io/doc/io.micrometer/micrometer-core/1.5.4/io/micrometer/core/instrument/simple/SimpleMeterRegistry.html">SimpleMeterRegistry (external site)</a></td>
<td><a class="reference external" href="https://nablarch.github.io/docs/LATEST/javadoc/nablarch/integration/micrometer/simple/SimpleMeterRegistryFactory.html" title="nablarch.integration.micrometer.simple.SimpleMeterRegistryFactory">SimpleMeterRegistryFactory</a></td>
<td><code class="docutils literal"><span class="pre">1.0.0</span></code> or higher</td>
</tr>
<tr class="row-odd"><td><a class="reference external" href="https://javadoc.io/doc/io.micrometer/micrometer-core/1.5.4/io/micrometer/core/instrument/logging/LoggingMeterRegistry.html">LoggingMeterRegistry (external site)</a></td>
<td><a class="reference external" href="https://nablarch.github.io/docs/LATEST/javadoc/nablarch/integration/micrometer/logging/LoggingMeterRegistryFactory.html" title="nablarch.integration.micrometer.logging.LoggingMeterRegistryFactory">LoggingMeterRegistryFactory</a></td>
<td><code class="docutils literal"><span class="pre">1.0.0</span></code> or higher</td>
</tr>
<tr class="row-even"><td><a class="reference external" href="https://javadoc.io/doc/io.micrometer/micrometer-registry-cloudwatch2/1.5.4/io/micrometer/cloudwatch2/CloudWatchMeterRegistry.html">CloudWatchMeterRegistry (external site)</a></td>
<td><a class="reference external" href="https://nablarch.github.io/docs/LATEST/javadoc/nablarch/integration/micrometer/cloudwatch/CloudWatchMeterRegistryFactory.html" title="nablarch.integration.micrometer.cloudwatch.CloudWatchMeterRegistryFactory">CloudWatchMeterRegistryFactory</a></td>
<td><code class="docutils literal"><span class="pre">1.0.0</span></code> or higher</td>
</tr>
<tr class="row-odd"><td><a class="reference external" href="https://javadoc.io/doc/io.micrometer/micrometer-registry-datadog/1.5.4/io/micrometer/datadog/DatadogMeterRegistry.html">DatadogMeterRegistry (external site)</a></td>
<td><a class="reference external" href="https://nablarch.github.io/docs/LATEST/javadoc/nablarch/integration/micrometer/datadog/DatadogMeterRegistryFactory.html" title="nablarch.integration.micrometer.datadog.DatadogMeterRegistryFactory">DatadogMeterRegistryFactory</a></td>
<td><code class="docutils literal"><span class="pre">1.0.0</span></code> or higher</td>
</tr>
<tr class="row-even"><td><a class="reference external" href="https://javadoc.io/doc/io.micrometer/micrometer-registry-statsd/1.5.4/io/micrometer/statsd/StatsdMeterRegistry.html">StatsdMeterRegistry (external site)</a></td>
<td><a class="reference external" href="https://nablarch.github.io/docs/LATEST/javadoc/nablarch/integration/micrometer/statsd/StatsdMeterRegistryFactory.html" title="nablarch.integration.micrometer.statsd.StatsdMeterRegistryFactory">StatsdMeterRegistryFactory</a></td>
<td><code class="docutils literal"><span class="pre">1.0.0</span></code> or higher</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="configuration-file">
<span id="micrometer-configuration"></span><h2><a class="toc-backref" href="#id10">Configuration File</a><a class="headerlink" href="#configuration-file" title="Permalink to this headline">¶</a></h2>
<div class="section" id="placement">
<h3><a class="toc-backref" href="#id11">Placement</a><a class="headerlink" href="#placement" title="Permalink to this headline">¶</a></h3>
<p>Create a configuration file for this adapter to be placed directly under the classpath with the name <code class="docutils literal"><span class="pre">micrometer.properties</span></code> .</p>
</div>
<div class="section" id="format">
<h3><a class="toc-backref" href="#id12">Format</a><a class="headerlink" href="#format" title="Permalink to this headline">¶</a></h3>
<p>Describe it in the following format</p>
<div class="highlight-text"><div class="highlight"><pre><span></span>nablarch.micrometer.&lt;subPrefix&gt;.&lt;key&gt;=&lt;value&gt;
</pre></div>
</div>
<p>The value specified for <code class="docutils literal"><span class="pre">&lt;subPrefix&gt;</span></code> is different for each registry factory used.</p>
<p>For each registry factory, the following table lists the values to specify for <code class="docutils literal"><span class="pre">&lt;subPrefix&gt;</span></code>.</p>
<table border="1" class="docutils">
<colgroup>
<col width="69%" />
<col width="31%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Registry factory</th>
<th class="head">subPrefix</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">SimpleMeterRegistryFactory</span></code></td>
<td><code class="docutils literal"><span class="pre">simple</span></code></td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">LoggingMeterRegistryFactory</span></code></td>
<td><code class="docutils literal"><span class="pre">logging</span></code></td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">CloudWatchMeterRegistryFactory</span></code></td>
<td><code class="docutils literal"><span class="pre">cloudwatch</span></code></td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">DatadogMeterRegistryFactory</span></code></td>
<td><code class="docutils literal"><span class="pre">datadog</span></code></td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">StatsdMeterRegistryFactory</span></code></td>
<td><code class="docutils literal"><span class="pre">statsd</span></code></td>
</tr>
</tbody>
</table>
<p><code class="docutils literal"><span class="pre">&lt;key&gt;</span></code> should be the same name as the method defined in <a class="reference external" href="https://javadoc.io/doc/io.micrometer/micrometer-core/1.5.4/io/micrometer/core/instrument/config/MeterRegistryConfig.html">configuration class (external site)</a>  that Micrometer provides per registry.</p>
<p>For example, there is a configuration class named <a class="reference external" href="https://javadoc.io/doc/io.micrometer/micrometer-registry-datadog/1.5.4/io/micrometer/datadog/DatadogConfig.html">DatadogConfig (external site)</a> for <a class="reference external" href="https://javadoc.io/doc/io.micrometer/micrometer-registry-datadog/1.5.4/io/micrometer/datadog/DatadogMeterRegistry.html">DatadogMeterRegistry (external site)</a> .
And in this configuration class, a method named <a class="reference external" href="https://javadoc.io/doc/io.micrometer/micrometer-registry-datadog/1.5.4/io/micrometer/datadog/DatadogConfig.html#apiKey()">apyKey (external site)</a> is defined.</p>
<p>Therefore, can configure your <code class="docutils literal"><span class="pre">apiKey</span></code> by writing in your <code class="docutils literal"><span class="pre">micrometer.properties</span></code> like this.</p>
<div class="highlight-text"><div class="highlight"><pre><span></span>nablarch.micrometer.datadog.apiKey=XXXXXXXXXXXXXXXXXXXX
</pre></div>
</div>
</div>
<div class="section" id="override-with-os-environment-variables-or-system-properties">
<h3><a class="toc-backref" href="#id13">Override with OS environment variables or system properties</a><a class="headerlink" href="#override-with-os-environment-variables-or-system-properties" title="Permalink to this headline">¶</a></h3>
<p>The configuration values in <code class="docutils literal"><span class="pre">micrometer.properties</span></code> can be overridden by OS environment variables or system properties.</p>
<p>The configuration values are adopted in the following order of priority.</p>
<ol class="arabic simple">
<li>The value specified in system properties</li>
<li>Value specified in OS environment variables</li>
<li>Configuration values for <code class="docutils literal"><span class="pre">micrometer.properties</span></code></li>
</ol>
<p>For example, suppose you have the following conditions set.</p>
<p>micrometer.properties</p>
<blockquote>
<div><div class="highlight-text"><div class="highlight"><pre><span></span>nablarch.micrometer.example.one=PROPERTIES
nablarch.micrometer.example.two=PROPERTIES
nablarch.micrometer.example.three=PROPERTIES
</pre></div>
</div>
</div></blockquote>
<p>OS environment variables</p>
<blockquote>
<div><div class="highlight-text"><div class="highlight"><pre><span></span>$ export NABLARCH_MICROMETER_EXAMPLE_TWO=OS_ENV

$ export NABLARCH_MICROMETER_EXAMPLE_THREE=OS_ENV
</pre></div>
</div>
</div></blockquote>
<p>system properties</p>
<blockquote>
<div><div class="highlight-text"><div class="highlight"><pre><span></span>-Dnablarch.micrometer.example.three=SYSTEM_PROP
</pre></div>
</div>
</div></blockquote>
<p>In this case, each set value will eventually adopt the following values</p>
<table border="1" class="docutils">
<colgroup>
<col width="38%" />
<col width="62%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Key</th>
<th class="head">Value adopted</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">one</span></code></td>
<td><code class="docutils literal"><span class="pre">PROPERTIES</span></code></td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">two</span></code></td>
<td><code class="docutils literal"><span class="pre">OS_ENV</span></code></td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">three</span></code></td>
<td><code class="docutils literal"><span class="pre">SYSTEM_PROP</span></code></td>
</tr>
</tbody>
</table>
<p>For rules on naming when overwriting with OS environment variables, see <a class="reference internal" href="../application_framework/libraries/repository.html#repository-overwrite-environment-configuration-by-os-env-var-naming-rule"><span>About the names of OS environment variables</span></a> .</p>
</div>
<div class="section" id="changing-the-configuration-prefix">
<h3><a class="toc-backref" href="#id14">Changing the configuration prefix</a><a class="headerlink" href="#changing-the-configuration-prefix" title="Permalink to this headline">¶</a></h3>
<p>The configuration prefix (<code class="docutils literal"><span class="pre">nablarch.micrometer.&lt;subPrefix&gt;</span></code>) can be changed by specifying the <a class="reference external" href="https://nablarch.github.io/docs/LATEST/javadoc/nablarch/integration/micrometer/MeterRegistryFactory.html#setPrefix-java.lang.String-" title="nablarch.integration.micrometer.MeterRegistryFactory.setPrefix(java.lang.String)">prefix</a> property for each registry factory.</p>
<p>Below is an example of changing the prefix.</p>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;component</span> <span class="na">name=</span><span class="s">&quot;meterRegistry&quot;</span> <span class="na">class=</span><span class="s">&quot;nablarch.integration.micrometer.logging.LoggingMeterRegistryFactory&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;meterBinderListProvider&quot;</span> <span class="na">ref=</span><span class="s">&quot;meterBinderListProvider&quot;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;applicationDisposer&quot;</span> <span class="na">ref=</span><span class="s">&quot;disposer&quot;</span> <span class="nt">/&gt;</span>

  <span class="c">&lt;!-- Configuring the prefix property with an arbitrary prefix --&gt;</span>
  <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;prefix&quot;</span> <span class="na">value=</span><span class="s">&quot;sample.prefix&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/component&gt;</span>
</pre></div>
</div>
<p>In this case, the <code class="docutils literal"><span class="pre">micrometer.properties</span></code> can be configured as follows</p>
<div class="highlight-text"><div class="highlight"><pre><span></span>sample.prefix.step=10s
</pre></div>
</div>
</div>
<div class="section" id="changing-the-place-of-the-configuration-file">
<h3><a class="toc-backref" href="#id15">Changing the place of the configuration file</a><a class="headerlink" href="#changing-the-place-of-the-configuration-file" title="Permalink to this headline">¶</a></h3>
<p>The place of the configuration file (<code class="docutils literal"><span class="pre">micrometer.properties</span></code>) can be changed in the following ways.</p>
<p>First, specify the path of the XML file to load the configuration file in <a class="reference external" href="https://nablarch.github.io/docs/LATEST/javadoc/nablarch/integration/micrometer/MeterRegistryFactory.html#setXmlConfigPath-java.lang.String-" title="nablarch.integration.micrometer.MeterRegistryFactory.setXmlConfigPath(java.lang.String)">xmlConfigPath</a> property of the registry factory.</p>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;component</span> <span class="na">name=</span><span class="s">&quot;meterRegistry&quot;</span> <span class="na">class=</span><span class="s">&quot;nablarch.integration.micrometer.logging.LoggingMeterRegistryFactory&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;meterBinderListProvider&quot;</span> <span class="na">ref=</span><span class="s">&quot;meterBinderListProvider&quot;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;applicationDisposer&quot;</span> <span class="na">ref=</span><span class="s">&quot;disposer&quot;</span> <span class="nt">/&gt;</span>

  <span class="c">&lt;!-- Specify the path of the XML file to load the configuration file --&gt;</span>
  <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;xmlConfigPath&quot;</span> <span class="na">value=</span><span class="s">&quot;config/metrics.xml&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/component&gt;</span>
</pre></div>
</div>
<p>And, place the XML file to load the configuration file at the place specified in the <code class="docutils literal"><span class="pre">xmlConfigPath</span></code> property.
In the following configuration, <code class="docutils literal"><span class="pre">config/metrics.properties</span></code> in the classpath will be loaded as a configuration file.</p>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;component-configuration</span>
        <span class="na">xmlns=</span><span class="s">&quot;http://tis.co.jp/nablarch/component-configuration&quot;</span>
        <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
        <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://tis.co.jp/nablarch/component-configuration https://nablarch.github.io/schema/component-configuration.xsd&quot;</span><span class="nt">&gt;</span>

  <span class="c">&lt;!-- Load Micrometer adapter Configuration --&gt;</span>
  <span class="nt">&lt;config-file</span> <span class="na">file=</span><span class="s">&quot;config/metrics.properties&quot;</span> <span class="nt">/&gt;</span>

<span class="nt">&lt;/component-configuration&gt;</span>
</pre></div>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p>This XML file can be written in the same format as the component configuration file.</p>
<p class="last">However, even if you define a component in this file, you will not be able to get a reference from the System Repository.</p>
</div>
</div>
</div>
<div class="section" id="metrics-collected-by-the-defaultmeterbinderlistprovider">
<span id="micrometer-default-metrics"></span><h2><a class="toc-backref" href="#id16">Metrics collected by the DefaultMeterBinderListProvider</a><a class="headerlink" href="#metrics-collected-by-the-defaultmeterbinderlistprovider" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://javadoc.io/doc/io.micrometer/micrometer-core/1.5.4/io/micrometer/core/instrument/binder/MeterBinder.html">MeterBinder (external site)</a> list generated by the <a class="reference external" href="https://nablarch.github.io/docs/LATEST/javadoc/nablarch/integration/micrometer/DefaultMeterBinderListProvider.html" title="nablarch.integration.micrometer.DefaultMeterBinderListProvider">DefaultMeterBinderListProvider</a> contains the following classes.</p>
<ul class="simple">
<li><a class="reference external" href="https://javadoc.io/doc/io.micrometer/micrometer-core/1.5.4/io/micrometer/core/instrument/binder/jvm/JvmMemoryMetrics.html">JvmMemoryMetrics (external site)</a></li>
<li><a class="reference external" href="https://javadoc.io/doc/io.micrometer/micrometer-core/1.5.4/io/micrometer/core/instrument/binder/jvm/JvmGcMetrics.html">JvmGcMetrics (external site)</a></li>
<li><a class="reference external" href="https://javadoc.io/doc/io.micrometer/micrometer-core/1.5.4/io/micrometer/core/instrument/binder/jvm/JvmThreadMetrics.html">JvmThreadMetrics (external site)</a></li>
<li><a class="reference external" href="https://javadoc.io/doc/io.micrometer/micrometer-core/1.5.4/io/micrometer/core/instrument/binder/jvm/ClassLoaderMetrics.html">ClassLoaderMetrics (external site)</a></li>
<li><a class="reference external" href="https://javadoc.io/doc/io.micrometer/micrometer-core/1.5.4/io/micrometer/core/instrument/binder/system/ProcessorMetrics.html">ProcessorMetrics (external site)</a></li>
<li><a class="reference external" href="https://javadoc.io/doc/io.micrometer/micrometer-core/1.5.4/io/micrometer/core/instrument/binder/system/FileDescriptorMetrics.html">FileDescriptorMetrics (external site)</a></li>
<li><a class="reference external" href="https://javadoc.io/doc/io.micrometer/micrometer-core/1.5.4/io/micrometer/core/instrument/binder/system/UptimeMetrics.html">UptimeMetrics (external site)</a></li>
<li><a class="reference external" href="https://nablarch.github.io/docs/LATEST/javadoc/nablarch/integration/micrometer/instrument/binder/jvm/NablarchGcCountMetrics.html" title="nablarch.integration.micrometer.instrument.binder.jvm.NablarchGcCountMetrics">NablarchGcCountMetrics</a></li>
</ul>
<p>This will enable the following metrics to be collected.</p>
<table border="1" class="docutils">
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Metrics Name</td>
<td>Description</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">jvm.buffer.count</span></code></td>
<td>The number of buffers in the buffer pool</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">jvm.buffer.memory.used</span></code></td>
<td>Buffer pool usage</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">jvm.buffer.total.capacity</span></code></td>
<td>Total capacity of the buffer pool</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">jvm.memory.used</span></code></td>
<td>Memory pool memory usage</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">jvm.memory.committed</span></code></td>
<td>The committed amount of memory in the memory pool</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">jvm.memory.max</span></code></td>
<td>The maximum amount of memory in the memory pool</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">jvm.gc.max.data.size</span></code></td>
<td>The maximum amount of memory in the OLD space</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">jvm.gc.live.data.size</span></code></td>
<td>Memory usage in the OLD space after Full GC</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">jvm.gc.memory.promoted</span></code></td>
<td>Incremental memory usage in the OLD space, increased before and after GC</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">jvm.gc.memory.allocated</span></code></td>
<td>Incremental memory usage in the young space from the previous GC to the current GC</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">jvm.gc.concurrent.phase.time</span></code></td>
<td>Concurrent phase processing time</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">jvm.gc.pause</span></code></td>
<td>Time spent on GC pause</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">jvm.threads.peak</span></code></td>
<td>Peak number of threads</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">jvm.threads.daemon</span></code></td>
<td>The number of current daemon threads</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">jvm.threads.live</span></code></td>
<td>The number of current non-demon threads</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">jvm.threads.states</span></code></td>
<td>The number of current threads per state</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">jvm.classes.loaded</span></code></td>
<td>The number of classes currently loaded</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">jvm.classes.unloaded</span></code></td>
<td>The number of classes that have been unloaded since the JVM was started</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">system.cpu.count</span></code></td>
<td>The number of processors available in the JVM</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">system.load.average.1m</span></code></td>
<td>Last minute system load average （Reference: <a class="reference external" href="https://docs.oracle.com/javase/jp/11/docs/api/java.management/java/lang/management/OperatingSystemMXBean.html#getSystemLoadAverage()">OperatingSystemMXBean(external site)</a> ）</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">system.cpu.usage</span></code></td>
<td>Recent system-wide CPU usage</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">process.cpu.usage</span></code></td>
<td>The JVM&#8217;s recent CPU usage</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">process.files.open</span></code></td>
<td>The number of open file descriptors</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">process.files.max</span></code></td>
<td>Maximum number of file descriptors</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">process.uptime</span></code></td>
<td>JVM uptime</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">process.start.time</span></code></td>
<td>JVM startup time (UNIX time)</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">jvm.gc.count</span></code></td>
<td>Number of GC</td>
</tr>
</tbody>
</table>
<p>See <a class="reference internal" href="#micrometer-metrics-output-example"><span>Execution Result</span></a> for an example of the actual metrics to be collected.</p>
</div>
<div class="section" id="configuring-common-tags">
<h2><a class="toc-backref" href="#id17">Configuring Common Tags</a><a class="headerlink" href="#configuring-common-tags" title="Permalink to this headline">¶</a></h2>
<p>The <a class="reference external" href="https://nablarch.github.io/docs/LATEST/javadoc/nablarch/integration/micrometer/MeterRegistryFactory.html#setTags-java.util.Map-" title="nablarch.integration.micrometer.MeterRegistryFactory.setTags(java.util.Map)">tags</a> property of the registry factory allows you to configure tags that are common to all metrics.</p>
<p>This feature can be used, for example, to set information that can identify the host, instance, region, etc. on which an application is running.</p>
<p>Describe how to set it up below.</p>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;component</span> <span class="na">name=</span><span class="s">&quot;meterRegistry&quot;</span> <span class="na">class=</span><span class="s">&quot;nablarch.integration.micrometer.logging.LoggingMeterRegistryFactory&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;meterBinderListProvider&quot;</span> <span class="na">ref=</span><span class="s">&quot;meterBinderListProvider&quot;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;applicationDisposer&quot;</span> <span class="na">ref=</span><span class="s">&quot;disposer&quot;</span> <span class="nt">/&gt;</span>

  <span class="c">&lt;!-- Configure common tags in the tags property --&gt;</span>
  <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;tags&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;map&gt;</span>
      <span class="nt">&lt;entry</span> <span class="na">key=</span><span class="s">&quot;foo&quot;</span> <span class="na">value=</span><span class="s">&quot;FOO&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;entry</span> <span class="na">key=</span><span class="s">&quot;bar&quot;</span> <span class="na">value=</span><span class="s">&quot;BAR&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/map&gt;</span>
  <span class="nt">&lt;/property&gt;</span>
<span class="nt">&lt;/component&gt;</span>
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">tags</span></code> property is of type <code class="docutils literal"><span class="pre">Map&lt;String,</span> <span class="pre">String&gt;</span></code>  and can be configured using a <code class="docutils literal"><span class="pre">&lt;map&gt;</span></code> tag.
In addition, the map key is mapped to the name of the tag and the map value is mapped to the tag value.</p>
<p>In the case of the above setup, the metrics to be collected are as follows.</p>
<div class="highlight-text"><div class="highlight"><pre><span></span>（Omitted）
2020-09-04 17:30:06.656 [INFO ]      i.m.c.i.l.LoggingMeterRegistry: process.start.time{bar=BAR,foo=FOO} value=444224h 29m 38.875000064s
2020-09-04 17:30:06.656 [INFO ]      i.m.c.i.l.LoggingMeterRegistry: process.uptime{bar=BAR,foo=FOO} value=27.849s
2020-09-04 17:30:06.656 [INFO ]      i.m.c.i.l.LoggingMeterRegistry: system.cpu.count{bar=BAR,foo=FOO} value=8
2020-09-04 17:30:06.657 [INFO ]      i.m.c.i.l.LoggingMeterRegistry: system.cpu.usage{bar=BAR,foo=FOO} value=0.475654
</pre></div>
</div>
<p>Can see that all metrics are set with the tags <code class="docutils literal"><span class="pre">foo=FOO</span></code>, <code class="docutils literal"><span class="pre">bar=BAR</span></code> .</p>
</div>
<div class="section" id="working-with-monitoring-services">
<h2><a class="toc-backref" href="#id18">Working with monitoring services</a><a class="headerlink" href="#working-with-monitoring-services" title="Permalink to this headline">¶</a></h2>
<p>In order to work with monitoring services, the following settings need to be made, broadly categorized.</p>
<ol class="arabic simple">
<li>Add a Micrometer module for each monitoring service to the dependencies.</li>
<li>Define a registry factory for the monitoring service as a component.</li>
<li>Configuring other proprietary settings for each monitoring service.</li>
</ol>
<p>This section describes how to work with each of the monitoring services.</p>
<div class="section" id="working-with-datadog">
<h3><a class="toc-backref" href="#id19">Working with Datadog</a><a class="headerlink" href="#working-with-datadog" title="Permalink to this headline">¶</a></h3>
<dl class="docutils">
<dt>Adding Dependencies</dt>
<dd><div class="first last highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;dependency&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>io.micrometer<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>micrometer-registry-datadog<span class="nt">&lt;/artifactId&gt;</span>
  <span class="nt">&lt;version&gt;</span>1.5.4<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</pre></div>
</div>
</dd>
<dt>Declare the Registry Factory</dt>
<dd><div class="first last highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;component</span> <span class="na">name=</span><span class="s">&quot;meterRegistry&quot;</span> <span class="na">class=</span><span class="s">&quot;nablarch.integration.micrometer.datadog.DatadogMeterRegistryFactory&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;meterBinderListProvider&quot;</span> <span class="na">ref=</span><span class="s">&quot;meterBinderListProvider&quot;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;applicationDisposer&quot;</span> <span class="na">ref=</span><span class="s">&quot;disposer&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/component&gt;</span>
</pre></div>
</div>
</dd>
<dt>Configuring the API key</dt>
<dd><div class="first highlight-text"><div class="highlight"><pre><span></span>nablarch.micrometer.datadog.apiKey=XXXXXXXXXXXXXXXX
</pre></div>
</div>
<p>The API key can be set in <code class="docutils literal"><span class="pre">nablarch.micrometer.datadog.apyKey</span></code> .</p>
<p class="last">See <a class="reference external" href="https://javadoc.io/doc/io.micrometer/micrometer-registry-datadog/1.5.4/io/micrometer/datadog/DatadogConfig.html">DatadogConfig (external site)</a> for other configuration.</p>
</dd>
</dl>
</div>
<div class="section" id="working-with-cloudwatch">
<h3><a class="toc-backref" href="#id20">Working with CloudWatch</a><a class="headerlink" href="#working-with-cloudwatch" title="Permalink to this headline">¶</a></h3>
<dl class="docutils">
<dt>Adding Dependencies</dt>
<dd><div class="first last highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;dependency&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>io.micrometer<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>micrometer-registry-cloudwatch2<span class="nt">&lt;/artifactId&gt;</span>
  <span class="nt">&lt;version&gt;</span>1.5.4<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</pre></div>
</div>
</dd>
<dt>Declare the Registry Factory</dt>
<dd><div class="first last highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;component</span> <span class="na">name=</span><span class="s">&quot;meterRegistry&quot;</span> <span class="na">class=</span><span class="s">&quot;nablarch.integration.micrometer.cloudwatch.CloudWatchMeterRegistryFactory&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;meterBinderListProvider&quot;</span> <span class="na">ref=</span><span class="s">&quot;meterBinderListProvider&quot;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;applicationDisposer&quot;</span> <span class="na">ref=</span><span class="s">&quot;disposer&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/component&gt;</span>
</pre></div>
</div>
</dd>
<dt>Configure the region, access keys, etc</dt>
<dd><div class="first highlight-bash"><div class="highlight"><pre><span></span>$ <span class="nb">export</span> <span class="nv">AWS_REGION</span><span class="o">=</span>ap-northeast-1

$ <span class="nb">export</span> <span class="nv">AWS_ACCESS_KEY_ID</span><span class="o">=</span>XXXXXXXXXXXXXXXXXXXXX

$ <span class="nb">export</span> <span class="nv">AWS_SECRET_ACCESS_KEY</span><span class="o">=</span>YYYYYYYYYYYYYYYYYYYYY
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">micrometer-registry-cloudwatch2</span></code> module uses the AWS SDK.
Therefore, the configuration of the region, access keys, etc. follows the AWS SDK ways.</p>
<p class="last">The above describes an example of how to set up an OS environment variable in Linux.
For more information, see the <a class="reference external" href="https://docs.aws.amazon.com/sdk-for-java/v1/developer-guide/setup-credentials.html">AWS documentation (external site)</a> .</p>
</dd>
<dt>Configuring the namespace</dt>
<dd><div class="first highlight-text"><div class="highlight"><pre><span></span>nablarch.micrometer.cloudwatch.namespace=test
</pre></div>
</div>
<p>Custom metrics namespaces can be configured in <code class="docutils literal"><span class="pre">nablarch.micrometer.cloudwatch.namespace</span></code> .</p>
<p class="last">See <a class="reference external" href="https://javadoc.io/doc/io.micrometer/micrometer-registry-cloudwatch2/1.5.4/io/micrometer/cloudwatch2/CloudWatchConfig.html">CloudWatchConfig (external site)</a> for more configuration information.</p>
</dd>
<dt>More detailed configuration</dt>
<dd><p class="first">If want more detailed configuration that cannot be specified in the OS environment variables and configuration files, you can write a custom provider that implements <a class="reference external" href="https://nablarch.github.io/docs/LATEST/javadoc/nablarch/integration/micrometer/cloudwatch/CloudWatchAsyncClientProvider.html" title="nablarch.integration.micrometer.cloudwatch.CloudWatchAsyncClientProvider">CloudWatchAsyncClientProvider</a> .</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">example.micrometer.cloudwatch</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">nablarch.integration.micrometer.cloudwatch.CloudWatchAsyncClientProvider</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">software.amazon.awssdk.services.cloudwatch.CloudWatchAsyncClient</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CustomCloudWatchAsyncClientProvider</span> <span class="kd">implements</span> <span class="n">CloudWatchAsyncClientProvider</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">CloudWatchAsyncClient</span> <span class="nf">provide</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">CloudWatchAsyncClient</span>
                <span class="o">.</span><span class="na">builder</span><span class="o">()</span>
                <span class="o">.</span><span class="na">asyncConfiguration</span><span class="o">(...)</span> <span class="c1">// Do your own configuration</span>
                <span class="o">.</span><span class="na">build</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<p><a class="reference external" href="https://nablarch.github.io/docs/LATEST/javadoc/nablarch/integration/micrometer/cloudwatch/CloudWatchAsyncClientProvider.html" title="nablarch.integration.micrometer.cloudwatch.CloudWatchAsyncClientProvider">CloudWatchAsyncClientProvider</a> has a <code class="docutils literal"><span class="pre">provide()</span></code> method that provides the <code class="docutils literal"><span class="pre">CloudWatchAsyncClient</span></code> .
A custom provider implements the <code class="docutils literal"><span class="pre">provide()</span></code> method to build and return the <code class="docutils literal"><span class="pre">CloudWatchAsyncClient</span></code> with your desired configuration.</p>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;component</span> <span class="na">name=</span><span class="s">&quot;meterRegistry&quot;</span> <span class="na">class=</span><span class="s">&quot;nablarch.integration.micrometer.cloudwatch.CloudWatchMeterRegistryFactory&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;meterBinderListProvider&quot;</span> <span class="na">ref=</span><span class="s">&quot;meterBinderListProvider&quot;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;applicationDisposer&quot;</span> <span class="na">ref=</span><span class="s">&quot;disposer&quot;</span> <span class="nt">/&gt;</span>

  <span class="c">&lt;!-- Configure a custom provider for the cloudWatchAsyncClientProvider property --&gt;</span>
  <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;cloudWatchAsyncClientProvider&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;component</span> <span class="na">class=</span><span class="s">&quot;example.micrometer.cloudwatch.CustomCloudWatchAsyncClientProvider&quot;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;/property&gt;</span>
<span class="nt">&lt;/component&gt;</span>
</pre></div>
</div>
<p>The custom provider you write will be configured in the <a class="reference external" href="https://nablarch.github.io/docs/LATEST/javadoc/nablarch/integration/micrometer/cloudwatch/CloudWatchMeterRegistryFactory.html#setCloudWatchAsyncClientProvider-nablarch.integration.micrometer.cloudwatch.CloudWatchAsyncClientProvider-" title="nablarch.integration.micrometer.cloudwatch.CloudWatchMeterRegistryFactory.setCloudWatchAsyncClientProvider(nablarch.integration.micrometer.cloudwatch.CloudWatchAsyncClientProvider)">cloudWatchAsyncClientProvider</a> property of the <code class="docutils literal"><span class="pre">CloudWatchMeterRegistryFactory</span></code> .</p>
<p>This enables the <code class="docutils literal"><span class="pre">CloudWatchAsyncClient</span></code> generated by the custom provider to be used in the cooperation of the metrics.</p>
<div class="last admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">By default, the instance created by <a class="reference external" href="https://javadoc.io/static/software.amazon.awssdk/cloudwatch/2.13.4/software/amazon/awssdk/services/cloudwatch/CloudWatchAsyncClient.html#create--">CloudWatchAsyncClient.create() (external site)</a> is used.</p>
</div>
</dd>
</dl>
</div>
<div class="section" id="working-with-datadog-using-statsd">
<h3><a class="toc-backref" href="#id21">Working with Datadog using StatsD</a><a class="headerlink" href="#working-with-datadog-using-statsd" title="Permalink to this headline">¶</a></h3>
<p>Datadog supports <a class="reference external" href="https://docs.datadoghq.com/developers/dogstatsd/?tab=hostagent">DogStatsD (external site)</a>, which is a cooperation using the <a class="reference external" href="https://github.com/statsd/statsd">StatsD (external site)</a> protocol.</p>
<p>Therefore, Can use <code class="docutils literal"><span class="pre">micrometer-registry-statsd</span></code> module to connect to Datadog with StatsD.</p>
<p>In this section, we will use the case of cooperation with Datadog using the StatsD protocol as an example.
For more information on how to install DogStatsD, refer to <a class="reference external" href="https://docs.datadoghq.com/agent/">Datadog&#8217;s site (external site)</a> .</p>
<dl class="docutils">
<dt>Adding Dependencies</dt>
<dd><div class="first last highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;dependency&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>io.micrometer<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>micrometer-registry-statsd<span class="nt">&lt;/artifactId&gt;</span>
  <span class="nt">&lt;version&gt;</span>1.5.4<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</pre></div>
</div>
</dd>
<dt>Declare the Registry Factory</dt>
<dd><div class="first last highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;component</span> <span class="na">name=</span><span class="s">&quot;meterRegistry&quot;</span> <span class="na">class=</span><span class="s">&quot;nablarch.integration.micrometer.statsd.StatsdMeterRegistryFactory&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;meterBinderListProvider&quot;</span> <span class="na">ref=</span><span class="s">&quot;meterBinderListProvider&quot;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;applicationDisposer&quot;</span> <span class="na">ref=</span><span class="s">&quot;disposer&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/component&gt;</span>
</pre></div>
</div>
</dd>
<dt>Write a configuration file if necessary</dt>
<dd><p class="first">The configuration for working with the StatsD daemon has been adjusted so that the default values match those of DogStatsD installed in its default configuration.</p>
<p>Therefore, if DogStatsD is installed in the default configuration, the cooperation by DogStatsD will work without any explicit settings.</p>
<p>If you have installed a non-default configuration, refer to <a class="reference external" href="https://javadoc.io/doc/io.micrometer/micrometer-registry-statsd/1.5.4/io/micrometer/statsd/StatsdConfig.html">StatsdConfig (external site)</a> to configure it for actual environment.</p>
<div class="last highlight-text"><div class="highlight"><pre><span></span># Change Port
nablarch.micrometer.statsd.port=9999
</pre></div>
</div>
</dd>
</dl>
</div>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>

    <hr/>

    <div role="contentinfo">
        <p>
            &copy; Copyright 2010-2020, TIS Inc.
        </p>
    </div>
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'5u18',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: ''
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>
      <script type="text/javascript" src="../../_static/custom.js"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>