


<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv='content-language' content='ja'>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Doma Adapter &mdash; ∇Nablarch  6u3 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  

  

  
  <link rel="canonical" href="https://nablarch.github.io/docs/LATEST/doc/application_framework/adaptors/doma_adaptor.html" />
  
    <link rel="top" title="∇Nablarch  6u3 documentation" href="../../index.html"/>
        <link rel="up" title="Adaptor" href="index.html"/>
        <link rel="next" title="JSR310(Date and Time API)Adapter" href="jsr310_adaptor.html"/>
        <link rel="prev" title="Jakarta RESTful Web Services Adapter" href="jaxrs_adaptor.html"/>

<script defer data-domain="nablarch.github.io,all.fintan" src=https://plausible.io/js/script.js></script>


  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          
  
  <a href="../../index.html" id="sidebar-title" class="icon"> ∇Nablarch 
  

  
    <div id="sidebar-version">Version: 6u3</div>
  </a>

  <div role="search">
    <form id="google-search-form" class="wy-form" method="get" action="https://www.google.co.jp/search">
      <input type="text" name="text" placeholder="Search docs on google" id="text"/>
      <input type="hidden" name="q" id="q"/>
    </form>
  </div>
    
    

        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
  
  
    <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../about_nablarch/index.html">What is the Nablarch?</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../about_nablarch/concept.html">Nablarch Concept</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../about_nablarch/concept.html#robustness">Robustness</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../about_nablarch/concept.html#testability">Testability</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../about_nablarch/concept.html#ready-to-use">Ready-to-Use</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../about_nablarch/mvn_module.html">Module List of Nablarch</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../about_nablarch/license.html">Information on Nablarch License</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Nablarch Application Framework</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../application_framework/index.html">Application Framework</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../application_framework/nablarch/index.html">What is Nablarch Application Framework?</a></li>
<li class="toctree-l3"><a class="reference internal" href="../application_framework/web/index.html">Web Application</a></li>
<li class="toctree-l3"><a class="reference internal" href="../application_framework/web_service/index.html">Web Service</a></li>
<li class="toctree-l3"><a class="reference internal" href="../application_framework/batch/index.html">Batch Application</a></li>
<li class="toctree-l3"><a class="reference internal" href="../application_framework/messaging/index.html">Messaging</a></li>
<li class="toctree-l3"><a class="reference internal" href="../application_framework/handlers/index.html">Standard Handler Provided by Nablarch</a></li>
<li class="toctree-l3"><a class="reference internal" href="../application_framework/libraries/index.html">Libraries Provided by Nablarch</a></li>
<li class="toctree-l3"><a class="reference internal" href="../application_framework/blank_project/index.html">Blank Project</a></li>
<li class="toctree-l3"><a class="reference internal" href="../application_framework/setting_guide/index.html">Nablarch Application Framework Configuration Guide</a></li>
<li class="toctree-l3"><a class="reference internal" href="../application_framework/configuration/index.html">Default Configuration List</a></li>
<li class="toctree-l3"><a class="reference internal" href="../application_framework/cloud_native/index.html">Nablarch Cloud Native Support</a></li>
</ul>
</li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Adaptor</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="log_adaptor.html">log Adapter</a></li>
<li class="toctree-l3"><a class="reference internal" href="router_adaptor.html">Routing Adapter</a></li>
<li class="toctree-l3"><a class="reference internal" href="webspheremq_adaptor.html">IBM MQ Adapter</a></li>
<li class="toctree-l3"><a class="reference internal" href="jaxrs_adaptor.html">Jakarta RESTful Web Services Adapter</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="">Doma Adapter</a></li>
<li class="toctree-l3"><a class="reference internal" href="jsr310_adaptor.html">JSR310(Date and Time API)Adapter</a></li>
<li class="toctree-l3"><a class="reference internal" href="mail_sender_freemarker_adaptor.html">E-mail FreeMarker Adapter</a></li>
<li class="toctree-l3"><a class="reference internal" href="mail_sender_thymeleaf_adaptor.html">E-mail Thymeleaf Adapter</a></li>
<li class="toctree-l3"><a class="reference internal" href="mail_sender_velocity_adaptor.html">E-mail Velocity Adapter</a></li>
<li class="toctree-l3"><a class="reference internal" href="web_thymeleaf_adaptor.html">Web Application Thymeleaf Adapter</a></li>
<li class="toctree-l3"><a class="reference internal" href="lettuce_adaptor.html">Lettuce Adapter</a></li>
<li class="toctree-l3"><a class="reference internal" href="slf4j_adaptor.html">SLF4J Adapter</a></li>
<li class="toctree-l3"><a class="reference internal" href="micrometer_adaptor.html">Micrometer Adapter</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../development_tools/index.html">Nablarch development tools</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../development_tools/java_static_analysis/index.html">Efficient Java Static Checks</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../development_tools/java_static_analysis/index.html#run-inspection">Run inspection</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../development_tools/java_static_analysis/index.html#unify-the-format">Unify the format</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../development_tools/java_static_analysis/index.html#check-if-unauthorized-apis-are-being-used">Check if unauthorized APIs are being used</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../development_tools/testing_framework/index.html">Testing framework</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../development_tools/testing_framework/guide/development_guide/05_UnitTestGuide/index.html">How to Execute Unit Tests</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../development_tools/testing_framework/guide/development_guide/06_TestFWGuide/index.html">How to Use the Automated Test Framework</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../development_tools/testing_framework/guide/development_guide/08_TestTools/index.html">Tools Used in the Programming Phase</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../development_tools/toolbox/index.html">Useful Tools When Developing Applications</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../development_tools/toolbox/JspStaticAnalysis/index.html">Jakarta Server Pages Static Analysis Tool</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../development_tools/toolbox/SqlExecutor/SqlExecutor.html">Nablarch SQL Executor</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../development_tools/toolbox/NablarchOpenApiGenerator/NablarchOpenApiGenerator.html">Nablarch OpenAPI Generator</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../examples/index.html">Example</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../examples/index.html#how-to-run-example">How to Run Example</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../examples/index.html#procedure-to-build-the-environment">Procedure to build the environment</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../examples/index.html#procedure-to-execute">Procedure to execute</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../examples/index.html#running-on-java-21">Running on Java 21</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../examples/index.html#list-of-example">List of Example</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../examples/index.html#web-application">Web application</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../examples/index.html#web-service">Web Service</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../examples/index.html#batch-application">Batch Application</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../examples/index.html#messaging">Messaging</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../biz_samples/index.html">Implementation Examples Per Use Cases</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../biz_samples/01/index.html">Sample Password Encryption Function Using Database</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../biz_samples/01/0101_PBKDF2PasswordEncryptor.html">Sample Password Encryption Function Using PBKDF2</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../biz_samples/01/index.html#delivery-package">Delivery package</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../biz_samples/01/index.html#summary">Summary</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../biz_samples/01/index.html#structure">Structure</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../biz_samples/01/index.html#how-to-use">How to Use</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../biz_samples/03/index.html">Display a List of Search Results</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../biz_samples/03/index.html#delivery-package">Delivery package</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../biz_samples/03/index.html#summary">Summary</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../biz_samples/03/index.html#structure">Structure</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../biz_samples/03/index.html#universaldao-class">UniversalDao class</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../biz_samples/03/index.html#listsearchinfo-class">ListSearchInfo class</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../biz_samples/03/index.html#pagination-class">Pagination class</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../biz_samples/03/index.html#entitylist-class">EntityList class</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../biz_samples/03/index.html#listsearchresult-tag">listSearchResult tag</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../biz_samples/03/index.html#how-to-import-a-sample-implementation-tag-file-into-the-business-application">How to import a sample implementation (tag file) into the business application</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../biz_samples/03/index.html#tag-reference">Tag Reference</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../biz_samples/04/index.html">Extended Formatter Functions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../biz_samples/04/0401_ExtendedDataFormatter.html">Data Formatter Expansion</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../biz_samples/04/0402_ExtendedFieldType.html">Field Type Expansion in the Data Formatter Function</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../biz_samples/05/index.html">Sample File Management Function Using Database</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../biz_samples/05/index.html#summary">Summary</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../biz_samples/05/index.html#functions">Functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../biz_samples/05/index.html#structure">Structure</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../biz_samples/05/index.html#how-to-use">How to Use</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../biz_samples/08/index.html">Sample of HTML Email Send Function</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../biz_samples/08/index.html#summary">Summary</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../biz_samples/08/index.html#request">Request</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../biz_samples/08/index.html#structure">Structure</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../biz_samples/08/index.html#implementation-examples">Implementation examples</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../biz_samples/09/index.html">How to Use a Sample to Send a Digitally Signed Email Using Bouncycastle</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../biz_samples/09/index.html#environment-preparation">Environment preparation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../biz_samples/09/index.html#structure-of-digitally-signed-email-send-function">Structure of digitally signed email send function</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../biz_samples/09/index.html#preparation-of-configuration-file">Preparation of configuration file</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../biz_samples/09/index.html#execution">Execution</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../biz_samples/10/index.html">How to Use the Log Aggregation Sample</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../biz_samples/10/index.html#list-of-samples-provided">List of samples provided</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../biz_samples/11/index.html">Messaging Platform Test Simulator Sample</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../biz_samples/11/index.html#uses">Uses</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../biz_samples/11/index.html#features">Features</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../biz_samples/11/index.html#request">Request</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../biz_samples/11/index.html#how-to-use">How to use</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../biz_samples/11/index.html#expansion-example">Expansion example</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../biz_samples/12/index.html">Authentication sample using OIDC ID token</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../biz_samples/12/index.html#delivery-package">Delivery package</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../biz_samples/12/index.html#summary">Summary</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../biz_samples/12/index.html#structure">Structure</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../biz_samples/12/index.html#how-to-use">How to Use</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../biz_samples/13/index.html">Sample Request/Response Log Output Using Logbook</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../biz_samples/13/index.html#summary">Summary</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../biz_samples/13/index.html#how-to-use">How to Use</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../external_contents/index.html">Useful content for development in Nablarch</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../external_contents/index.html#nablarch-system-development-guide">Nablarch System Development Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../external_contents/index.html#development-standards">Development Standards</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../nablarch_api/index.html">Nablarch API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../about_nablarch/versionup_policy.html">Nablarch upgrade policy</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../about_nablarch/versionup_policy.html#release-unit">Release unit</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../about_nablarch/versionup_policy.html#types-of-upgrades">Types of upgrades</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../about_nablarch/versionup_policy.html#version-numbering-system">Version numbering system</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../about_nablarch/versionup_policy.html#backward-compatibility-policy">Backward compatibility policy</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../about_nablarch/versionup_policy.html#extent-to-which-backward-compatibility-is-maintained">Extent to which backward compatibility is maintained</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../about_nablarch/versionup_policy.html#contents-of-backward-compatibility-maintenance">Contents of backward compatibility maintenance</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../about_nablarch/versionup_policy.html#backward-compatibility-exception">Backward compatibility exception</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../migration/index.html">Nablarch 5 to 6 Migration Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../migration/index.html#major-differences-between-nablarch-5-and-6">Major differences between Nablarch 5 and 6</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../migration/index.html#supports-jakarta-ee-10">Supports Jakarta EE 10</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../migration/index.html#changed-required-java-version-to-17">Changed  required Java version to 17</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../migration/index.html#prerequisites">Prerequisites</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../migration/index.html#overview-of-migration-steps">Overview of migration steps</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../migration/index.html#details-of-migration-steps">Details of migration steps</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../migration/index.html#nablarch-version-upgrade">Nablarch version upgrade</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../migration/index.html#compatible-with-jakarta-ee">Compatible with Jakarta EE</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../migration/index.html#migration-procedure-of-jsr352-compliant-batch-application">Migration procedure of JSR352-compliant Batch Application</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../migration/index.html#what-to-do-if-an-error-occurs-during-execution">What to do if an error occurs during execution</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../migration/index.html#appendix">Appendix</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../migration/index.html#correspondence-table-between-java-ee-and-jakarta-ee-specifications">Correspondence table between Java EE and Jakarta EE specifications</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../jakarta_ee/index.html">Regarding the specification name of Jakarta EE</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../jakarta_ee/index.html#regarding-the-notation-of-acronyms">Regarding the notation of acronyms</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../jakarta_ee/index.html#regarding-features-that-have-been-renamed-in-nablarch-5-and-6">Regarding features that have been renamed in Nablarch 5 and 6</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../terms_of_use/index.html">Terms of Use</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../terms_of_use/index.html#external-transmssion-of-information">External Transmssion of Information</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../terms_of_use/index.html#purpose-of-information-use">Purpose of Information Use</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../terms_of_use/index.html#destination-of-information">Destination of information</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../terms_of_use/index.html#type-and-use-of-information">Type and use of information</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">∇Nablarch </a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../index.html">Nablarch Application Framework</a> &raquo;</li>
      
          <li><a href="index.html">Adaptor</a> &raquo;</li>
      
    <li>Doma Adapter</li>
    <li class="wy-breadcrumbs-aside">
      <a href="https://github.com/nablarch" class="fa fa-github">GitHub</a>
    </li>
    <li class="wy-breadcrumbs-aside">
        <a href="https://nablarch.github.io/docs/LATEST/doc/index.html" class="ja">日本語</a>
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="doma-adapter">
<span id="doma-adaptor"></span><h1>Doma Adapter<a class="headerlink" href="#doma-adapter" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="table-of-contents">
<p class="topic-title first">Table of contents</p>
<ul class="simple">
<li><a class="reference internal" href="#module-list" id="id1">Module list</a></li>
<li><a class="reference internal" href="#configuration-for-using-the-doma-adapter" id="id2">Configuration for using the Doma adapter</a><ul>
<li><a class="reference internal" href="#configure-dependencies" id="id3">Configure dependencies</a></li>
<li><a class="reference internal" href="#configure-the-doma-dialect-and-data-source-to-match-the-rdbms-you-are-using" id="id4">Configure the Doma dialect and data source to match the RDBMS you are using</a></li>
</ul>
</li>
<li><a class="reference internal" href="#access-the-database-using-doma" id="id5">Access the database using Doma</a><ul>
<li><a class="reference internal" href="#create-dao-interface" id="id6">Create Dao interface</a></li>
<li><a class="reference internal" href="#implement-database-access-processing" id="id7">Implement database access processing</a></li>
</ul>
</li>
<li><a class="reference internal" href="#execute-in-another-transaction" id="id8">Execute in another transaction</a></li>
<li><a class="reference internal" href="#using-in-a-jakarta-batch-compliant-batch-application" id="id9">Using in a Jakarta Batch-compliant batch application</a></li>
<li><a class="reference internal" href="#deferred-loading-in-jakarta-batch-compliant-batch-applications" id="id10">Deferred loading in Jakarta Batch-compliant batch applications</a></li>
<li><a class="reference internal" href="#accessing-multiple-databases" id="id11">Accessing multiple databases</a></li>
<li><a class="reference internal" href="#use-doma-and-nablarch-database-access-together" id="id12">Use Doma and Nablarch database access together</a></li>
<li><a class="reference internal" href="#switch-logger" id="id13">Switch logger</a></li>
<li><a class="reference internal" href="#perform-configuration-for-java-sql-statement" id="id14">Perform configuration for java.sql.Statement</a></li>
<li><a class="reference internal" href="#migrating-from-doma-2-44-0" id="id15">Migrating from Doma 2.44.0</a><ul>
<li><a class="reference internal" href="#if-you-are-using-the-basic-implementation-using-domaconfig" id="id16">If you are using the basic implementation using DomaConfig</a></li>
<li><a class="reference internal" href="#if-you-are-using-domatransactionnotsupportedconfig-for-lazy-loading" id="id17">If you are using DomaTransactionNotSupportedConfig for lazy loading</a></li>
<li><a class="reference internal" href="#if-you-have-created-your-own-config-class" id="id18">If you have created your own Config class</a></li>
</ul>
</li>
</ul>
</div>
<p>Provides an adapter to access the database using <a class="reference external" href="https://doma.readthedocs.io/en/latest/">Doma2(external site)</a></p>
<p>Using Doma for database access offers the following benefits:</p>
<ul class="simple">
<li>Like Nablarch, you can build SQL statements dynamically during execution.</li>
<li>Since it is 2waySQL, SQL statements are not required to be rewritten as in Nablarch and can be executed directly using an SQL tool.</li>
</ul>
<p>Since only the actions specified in  <a class="reference external" href="https://nablarch.github.io/docs/6u3/javadoc/nablarch/integration/doma/Transactional.html" title="nablarch.integration.doma.Transactional">Transactional</a> .
interceptor can be subject to transaction management by using this adapter, unnecessary transaction control processing is reduced, and performance is improved.</p>
<div class="section" id="module-list">
<h2><a class="toc-backref" href="#id1">Module list</a><a class="headerlink" href="#module-list" title="Permalink to this headline">¶</a></h2>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="c">&lt;!-- Doma adaptor --&gt;</span>
<span class="nt">&lt;dependency&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>com.nablarch.integration<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>nablarch-doma-adaptor<span class="nt">&lt;/artifactId&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</pre></div>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">Tests are conducted using Doma version 2.62.0.
When changing the version, test in the project to confirm that there are no problems.</p>
</div>
</div>
<div class="section" id="configuration-for-using-the-doma-adapter">
<h2><a class="toc-backref" href="#id2">Configuration for using the Doma adapter</a><a class="headerlink" href="#configuration-for-using-the-doma-adapter" title="Permalink to this headline">¶</a></h2>
<p>The steps for using this adapter are shown below.</p>
<div class="section" id="configure-dependencies">
<h3><a class="toc-backref" href="#id3">Configure dependencies</a><a class="headerlink" href="#configure-dependencies" title="Permalink to this headline">¶</a></h3>
<p>You need to set the project dependencies by referring to the following.</p>
<p>For details, see <a class="reference external" href="https://doma.readthedocs.io/en/latest/build/#build-with-maven">Maven build configuration in Doma2(external site)</a> .</p>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;build&gt;</span>
    <span class="nt">&lt;plugins&gt;</span>
        <span class="nt">&lt;plugin&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.apache.maven.plugins<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>maven-compiler-plugin<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;configuration&gt;</span>
                <span class="nt">&lt;annotationProcessorPaths&gt;</span>
                    <span class="nt">&lt;path&gt;</span>
                        <span class="nt">&lt;groupId&gt;</span>org.seasar.doma<span class="nt">&lt;/groupId&gt;</span>
                        <span class="nt">&lt;artifactId&gt;</span>doma-processor<span class="nt">&lt;/artifactId&gt;</span>
                        <span class="nt">&lt;version&gt;</span>2.62.0<span class="nt">&lt;/version&gt;</span>
                    <span class="nt">&lt;/path&gt;</span>
                <span class="nt">&lt;/annotationProcessorPaths&gt;</span>
                <span class="c">&lt;!-- If you are using Eclipse, set the following arguments.</span>
<span class="c">                &lt;compilerArgs&gt;</span>
<span class="c">                    &lt;arg&gt;-Adoma.resources.dir=${project.basedir}/src/main/resources&lt;/arg&gt;</span>
<span class="c">                &lt;/compilerArgs&gt;</span>
<span class="c">                --&gt;</span>
            <span class="nt">&lt;/configuration&gt;</span>
        <span class="nt">&lt;/plugin&gt;</span>
    <span class="nt">&lt;/plugins&gt;</span>
<span class="nt">&lt;/build&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="configure-the-doma-dialect-and-data-source-to-match-the-rdbms-you-are-using">
<h3><a class="toc-backref" href="#id4">Configure the Doma dialect and data source to match the RDBMS you are using</a><a class="headerlink" href="#configure-the-doma-dialect-and-data-source-to-match-the-rdbms-you-are-using" title="Permalink to this headline">¶</a></h3>
<p>You need to define the Doma dialect and data source in the component configuration file to match the RDBMS used in your project.</p>
<p>A configuration example when H2 is used is shown below.</p>
<dl class="docutils">
<dt>Point</dt>
<dd><ul class="first last simple">
<li>The defined dialect should be an implementation class of  <code class="docutils literal"><span class="pre">org.seasar.doma.jdbc.dialect.Dialect</span></code> .</li>
<li>The component name of the dialect should be <code class="docutils literal"><span class="pre">domaDialect</span></code> .</li>
<li>The component name of the data source should be <code class="docutils literal"><span class="pre">dataSource</span></code> .</li>
</ul>
</dd>
</dl>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;component</span> <span class="na">name=</span><span class="s">&quot;domaDialect&quot;</span> <span class="na">class=</span><span class="s">&quot;org.seasar.doma.jdbc.dialect.H2Dialect&quot;</span>  <span class="nt">/&gt;</span>
<span class="nt">&lt;component</span> <span class="na">name=</span><span class="s">&quot;dataSource&quot;</span> <span class="na">class=</span><span class="s">&quot;org.h2.jdbcx.JdbcDataSource&quot;</span><span class="nt">&gt;</span>
  <span class="c">&lt;!--  Property omitted  --&gt;</span>
<span class="nt">&lt;/component&gt;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="access-the-database-using-doma">
<h2><a class="toc-backref" href="#id5">Access the database using Doma</a><a class="headerlink" href="#access-the-database-using-doma" title="Permalink to this headline">¶</a></h2>
<p>The procedure to access the database using Doma is shown below.</p>
<div class="section" id="create-dao-interface">
<h3><a class="toc-backref" href="#id6">Create Dao interface</a><a class="headerlink" href="#create-dao-interface" title="Permalink to this headline">¶</a></h3>
<p>Create Dao (Data Access Object) interface for database access.</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="nd">@Dao</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">ProjectDao</span> <span class="o">{</span>
        <span class="c1">// Omitted</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="section" id="implement-database-access-processing">
<h3><a class="toc-backref" href="#id7">Implement database access processing</a><a class="headerlink" href="#implement-database-access-processing" title="Permalink to this headline">¶</a></h3>
<p>Implement database access processing in business action method.</p>
<dl class="docutils">
<dt>Point</dt>
<dd><ul class="first simple">
<li>Configure <a class="reference external" href="https://nablarch.github.io/docs/6u3/javadoc/nablarch/integration/doma/Transactional.html" title="nablarch.integration.doma.Transactional">Transactional</a> interceptor to make business action method be subject to transaction management</li>
<li>Configure <a class="reference external" href="https://nablarch.github.io/docs/6u3/javadoc/nablarch/integration/doma/DomaDaoRepository.html#get(java.lang.Class)" title="nablarch.integration.doma.DomaDaoRepository.get(java.lang.Class)">DomaDaoRepository#get</a> to look up Dao implementation class</li>
</ul>
<blockquote class="last">
<div><div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">In Doma, since the implementation class of Dao is automatically generated during compilation by annotation processing, the implementation class does not exist as yet at the time of coding.
Therefore,  <a class="reference external" href="https://nablarch.github.io/docs/6u3/javadoc/nablarch/integration/doma/DomaDaoRepository.html" title="nablarch.integration.doma.DomaDaoRepository">DomaDaoRepository</a> is provided as a function to look up the implementation class of Dao in this adapter.</p>
</div>
</div></blockquote>
</dd>
</dl>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="nd">@Transactional</span>
<span class="kd">public</span> <span class="n">HttpResponse</span> <span class="nf">create</span><span class="o">(</span><span class="kd">final</span> <span class="n">HttpRequest</span> <span class="n">request</span><span class="o">,</span> <span class="kd">final</span> <span class="n">ExecutionContext</span> <span class="n">context</span><span class="o">)</span> <span class="o">{</span>
    <span class="kd">final</span> <span class="n">Project</span> <span class="n">project</span> <span class="o">=</span> <span class="n">SessionUtil</span><span class="o">.</span><span class="na">delete</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="s">&quot;project&quot;</span><span class="o">);</span>

    <span class="n">DomaDaoRepository</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">ProjectDao</span><span class="o">.</span><span class="na">class</span><span class="o">).</span><span class="na">insert</span><span class="o">(</span><span class="n">project</span><span class="o">);</span>

    <span class="k">return</span> <span class="k">new</span> <span class="n">HttpResponse</span><span class="o">(</span><span class="s">&quot;redirect://complete&quot;</span><span class="o">);</span>
<span class="o">}</span>
</pre></div>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">As the config attribute of the Dao annotation has been deprecated from Doma 2.44.0, the implementation method has changed from the information provided prior to Doma 2.44.0.
For more information, see <a class="reference internal" href="#migration-doma2-44-0"><span>Migrating from Doma 2.44.0</span></a> .</p>
</div>
</div>
</div>
<div class="section" id="execute-in-another-transaction">
<h2><a class="toc-backref" href="#id8">Execute in another transaction</a><a class="headerlink" href="#execute-in-another-transaction" title="Permalink to this headline">¶</a></h2>
<p>Accessing the database using a different transaction than the one started by the <a class="reference external" href="https://nablarch.github.io/docs/6u3/javadoc/nablarch/integration/doma/Transactional.html" title="nablarch.integration.doma.Transactional">Transactional</a> interceptor may be required in some cases</p>
<p>n that case, control in another transaction using TransactionManager fetched by  <a class="reference external" href="https://nablarch.github.io/docs/6u3/javadoc/nablarch/integration/doma/DomaConfig.html#getTransactionManager()" title="nablarch.integration.doma.DomaConfig.getTransactionManager()">DomaConfig#getTransactionManager</a>.</p>
<p>An implementation example is shown below.</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">DomaConfig</span><span class="o">.</span><span class="na">singleton</span><span class="o">()</span>
        <span class="o">.</span><span class="na">getTransactionManager</span><span class="o">()</span>
        <span class="o">.</span><span class="na">requiresNew</span><span class="o">(()</span> <span class="o">-&gt;</span>
                <span class="n">DomaDaoRepository</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">ProjectDao</span><span class="o">.</span><span class="na">class</span><span class="o">).</span><span class="na">insert</span><span class="o">(</span><span class="n">project</span><span class="o">);</span>
</pre></div>
</div>
</div>
<div class="section" id="using-in-a-jakarta-batch-compliant-batch-application">
<h2><a class="toc-backref" href="#id9">Using in a Jakarta Batch-compliant batch application</a><a class="headerlink" href="#using-in-a-jakarta-batch-compliant-batch-application" title="Permalink to this headline">¶</a></h2>
<p>The following listeners are provided in this adapter to use Doma in Jakarta Batch-compliant batch applications.</p>
<ul class="simple">
<li><a class="reference external" href="https://nablarch.github.io/docs/6u3/javadoc/nablarch/integration/doma/batch/ee/listener/DomaTransactionStepListener.html" title="nablarch.integration.doma.batch.ee.listener.DomaTransactionStepListener">DomaTransactionStepListener</a></li>
<li><a class="reference external" href="https://nablarch.github.io/docs/6u3/javadoc/nablarch/integration/doma/batch/ee/listener/DomaTransactionItemWriteListener.html" title="nablarch.integration.doma.batch.ee.listener.DomaTransactionItemWriteListener">DomaTransactionItemWriteListener</a></li>
</ul>
<p>By defining these listeners in the listener list, it is possible to access the database using Doma even in Jakarta Batch-compliant batch applications.</p>
<p>The configuration example shown below.</p>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;list</span> <span class="na">name=</span><span class="s">&quot;stepListeners&quot;</span><span class="nt">&gt;</span>
  <span class="c">&lt;!--  Other listeners are omitted  --&gt;</span>
  <span class="nt">&lt;component</span> <span class="na">class=</span><span class="s">&quot;nablarch.integration.doma.batch.ee.listener.DomaTransactionStepListener&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/list&gt;</span>

<span class="nt">&lt;list</span> <span class="na">name=</span><span class="s">&quot;itemWriteListeners&quot;</span><span class="nt">&gt;</span>
  <span class="c">&lt;!--  Other listeners are omitted  --&gt;</span>
  <span class="nt">&lt;component</span> <span class="na">class=</span><span class="s">&quot;nablarch.integration.doma.batch.ee.listener.DomaTransactionItemWriteListener&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/list&gt;</span>
</pre></div>
</div>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p>When performing batch update (batch insert, batch update, etc.) for the database with ItemWriter of <a class="reference internal" href="../application_framework/batch/jsr352/architecture.html#jsr352-batch-type-chunk"><span>Chunk step</span></a> , the batch size has to be specified explicitly.
※Note that the size of the item-count of the Chunk step is not the batch size</p>
<p>If the batch size is not specified explicitly, the default value of Doma will be applied, and performance may not improve by using batch updates.</p>
<dl class="last docutils">
<dt>Implementation examples</dt>
<dd><p class="first">For example, when batch insert is performed for every 1000 records, implement the Dao method as follows.</p>
<div class="last highlight-java"><div class="highlight"><pre><span></span><span class="nd">@BatchInsert</span><span class="o">(</span><span class="n">batchSize</span> <span class="o">=</span> <span class="mi">1000</span><span class="o">)</span>
<span class="kt">int</span><span class="o">[]</span> <span class="nf">batchInsert</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Bonus</span><span class="o">&gt;</span> <span class="n">bonuses</span><span class="o">);</span>
</pre></div>
</div>
</dd>
</dl>
</div>
</div>
<div class="section" id="deferred-loading-in-jakarta-batch-compliant-batch-applications">
<h2><a class="toc-backref" href="#id10">Deferred loading in Jakarta Batch-compliant batch applications</a><a class="headerlink" href="#deferred-loading-in-jakarta-batch-compliant-batch-applications" title="Permalink to this headline">¶</a></h2>
<p>When loading a large amount of data with Jakarta Batch-compliant batch applications, you may want to use deferred loading.</p>
<p>In that case, when looking up the Dao implementation class, use <a class="reference external" href="https://nablarch.github.io/docs/6u3/javadoc/nablarch/integration/doma/DomaDaoRepository.html#get(java.lang.Class,java.lang.Class)" title="nablarch.integration.doma.DomaDaoRepository.get(java.lang.Class,java.lang.Class)">DomaDaoRepository#get(java.lang.Class,java.lang.Class)</a> and specify the Class class of <a class="reference external" href="https://nablarch.github.io/docs/6u3/javadoc/nablarch/integration/doma/DomaTransactionNotSupportedConfig.html" title="nablarch.integration.doma.DomaTransactionNotSupportedConfig">DomaTransactionNotSupportedConfig</a> as the second argument.</p>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last">When <a class="reference external" href="https://nablarch.github.io/docs/6u3/javadoc/nablarch/integration/doma/DomaDaoRepository.html#get(java.lang.Class)" title="nablarch.integration.doma.DomaDaoRepository.get(java.lang.Class)">DomaDaoRepository#get(java.lang.Class)</a> is used, <a class="reference external" href="https://nablarch.github.io/docs/6u3/javadoc/nablarch/integration/doma/DomaConfig.html" title="nablarch.integration.doma.DomaConfig">DomaConfig</a> is used, therefore the stream is closed when the transaction is committed by <a class="reference external" href="https://nablarch.github.io/docs/6u3/javadoc/nablarch/integration/doma/batch/ee/listener/DomaTransactionItemWriteListener.html" title="nablarch.integration.doma.batch.ee.listener.DomaTransactionItemWriteListener">DomaTransactionItemWriteListener</a> , and subsequent records cannot be read.</p>
</div>
<p>An implementation example is shown below.</p>
<dl class="docutils">
<dt>Dao interface</dt>
<dd><dl class="first docutils">
<dt>Point</dt>
<dd><ul class="first last simple">
<li>The search result is fetched by <a class="reference external" href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/stream/Stream.html" title="java.util.stream.Stream">Stream</a>.</li>
</ul>
</dd>
</dl>
<div class="last highlight-java"><div class="highlight"><pre><span></span><span class="nd">@Dao</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">ProjectDao</span> <span class="o">{</span>

        <span class="nd">@Select</span><span class="o">(</span><span class="n">strategy</span> <span class="o">=</span> <span class="n">SelectType</span><span class="o">.</span><span class="na">RETURN</span><span class="o">)</span>
        <span class="n">Stream</span><span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span> <span class="nf">search</span><span class="o">();</span>
<span class="o">}</span>
</pre></div>
</div>
</dd>
<dt>ItemReader class</dt>
<dd><dl class="first docutils">
<dt>Point</dt>
<dd><ul class="first last simple">
<li>To get the Dao implementation class, use <a class="reference external" href="https://nablarch.github.io/docs/6u3/javadoc/nablarch/integration/doma/DomaDaoRepository.html#get(java.lang.Class,java.lang.Class)" title="nablarch.integration.doma.DomaDaoRepository.get(java.lang.Class,java.lang.Class)">DomaDaoRepository#get(java.lang.Class,java.lang.Class)</a> and specify <a class="reference external" href="https://nablarch.github.io/docs/6u3/javadoc/nablarch/integration/doma/DomaTransactionNotSupportedConfig.html" title="nablarch.integration.doma.DomaTransactionNotSupportedConfig">DomaTransactionNotSupportedConfig</a> as the second argument.</li>
<li>Fetch the search result stream with open method.</li>
<li>Always close the stream with the close method to prevent the release of resources.</li>
</ul>
</dd>
</dl>
<div class="last highlight-java"><div class="highlight"><pre><span></span><span class="nd">@Dependent</span>
<span class="nd">@Named</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ProjectReader</span> <span class="kd">extends</span> <span class="n">AbstractItemReader</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="n">Iterator</span><span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span> <span class="n">iterator</span><span class="o">;</span>

    <span class="kd">private</span> <span class="n">Stream</span><span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span> <span class="n">stream</span><span class="o">;</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">open</span><span class="o">(</span><span class="n">Serializable</span> <span class="n">checkpoint</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="kd">final</span> <span class="n">ProjectDao</span> <span class="n">dao</span> <span class="o">=</span> <span class="n">DomaDaoRepository</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">ProjectDao</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">DomaTransactionNotSupportedConfig</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="n">stream</span> <span class="o">=</span> <span class="n">dao</span><span class="o">.</span><span class="na">search</span><span class="o">();</span>
        <span class="n">iterator</span> <span class="o">=</span> <span class="n">stream</span><span class="o">.</span><span class="na">iterator</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">Object</span> <span class="nf">readItem</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">iterator</span><span class="o">.</span><span class="na">hasNext</span><span class="o">())</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">iterator</span><span class="o">.</span><span class="na">next</span><span class="o">();</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">close</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="n">stream</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
</dd>
</dl>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">As the config attribute of the Dao annotation has been deprecated from Doma 2.44.0, the implementation method has changed from the information provided prior to Doma 2.44.0.
For more information, see <a class="reference internal" href="#migration-doma2-44-0"><span>Migrating from Doma 2.44.0</span></a> .</p>
</div>
</div>
<div class="section" id="accessing-multiple-databases">
<h2><a class="toc-backref" href="#id11">Accessing multiple databases</a><a class="headerlink" href="#accessing-multiple-databases" title="Permalink to this headline">¶</a></h2>
<p>If more than one database is to be accessed, create a new config class and implement access to the other database using that config class.</p>
<p>An implementation example is shown below.</p>
<dl class="docutils">
<dt>Component configuration file</dt>
<dd><div class="first last highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;component</span> <span class="na">name=</span><span class="s">&quot;customDomaDialect&quot;</span> <span class="na">class=</span><span class="s">&quot;org.seasar.doma.jdbc.dialect.OracleDialect&quot;</span>  <span class="nt">/&gt;</span>
<span class="nt">&lt;component</span> <span class="na">name=</span><span class="s">&quot;customDataSource&quot;</span> <span class="na">class=</span><span class="s">&quot;oracle.jdbc.pool.OracleDataSource&quot;</span><span class="nt">&gt;</span>
  <span class="c">&lt;!--  Property omitted  --&gt;</span>
<span class="nt">&lt;/component&gt;</span>
</pre></div>
</div>
</dd>
<dt>Config class</dt>
<dd><dl class="first docutils">
<dt>Point</dt>
<dd><ul class="first last simple">
<li>Implement the Config interface provided by Doma.</li>
<li>It has public visibility and a no-arg constructor.</li>
</ul>
</dd>
</dl>
<div class="last highlight-java"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">CustomConfig</span> <span class="kd">implements</span> <span class="n">Config</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="nf">CustomConfig</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">dialect</span> <span class="o">=</span> <span class="n">SystemRepository</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">&quot;customDomaDialect&quot;</span><span class="o">);</span>
        <span class="n">localTransactionDataSource</span> <span class="o">=</span>
                <span class="k">new</span> <span class="n">LocalTransactionDataSource</span><span class="o">(</span><span class="n">SystemRepository</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">&quot;customDataSource&quot;</span><span class="o">));</span>
        <span class="n">localTransaction</span> <span class="o">=</span> <span class="n">localTransactionDataSource</span><span class="o">.</span><span class="na">getLocalTransaction</span><span class="o">(</span><span class="n">getJdbcLogger</span><span class="o">());</span>
        <span class="n">localTransactionManager</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LocalTransactionManager</span><span class="o">(</span><span class="n">localTransaction</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="c1">// Implement other fields and methods in reference to DomaConfig</span>
<span class="o">}</span>
</pre></div>
</div>
</dd>
<dt>Dao interface</dt>
<dd><div class="first last highlight-java"><div class="highlight"><pre><span></span><span class="nd">@Dao</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">ProjectDao</span> <span class="o">{</span>
    <span class="c1">// Omitted</span>
<span class="o">}</span>
</pre></div>
</div>
</dd>
<dt>Business action class</dt>
<dd><dl class="first docutils">
<dt>Point</dt>
<dd><ul class="first last simple">
<li>To get the Dao implementation class, use <a class="reference external" href="https://nablarch.github.io/docs/6u3/javadoc/nablarch/integration/doma/DomaDaoRepository.html#get(java.lang.Class,java.lang.Class)" title="nablarch.integration.doma.DomaDaoRepository.get(java.lang.Class,java.lang.Class)">DomaDaoRepository#get(java.lang.Class,java.lang.Class)</a> and specify the created Config class as the second argument.</li>
</ul>
</dd>
</dl>
<div class="last highlight-java"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="n">HttpResponse</span> <span class="nf">create</span><span class="o">(</span><span class="kd">final</span> <span class="n">HttpRequest</span> <span class="n">request</span><span class="o">,</span> <span class="kd">final</span> <span class="n">ExecutionContext</span> <span class="n">context</span><span class="o">)</span> <span class="o">{</span>
    <span class="kd">final</span> <span class="n">Project</span> <span class="n">project</span> <span class="o">=</span> <span class="n">SessionUtil</span><span class="o">.</span><span class="na">delete</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="s">&quot;project&quot;</span><span class="o">);</span>

    <span class="n">CustomConfig</span><span class="o">.</span><span class="na">singleton</span><span class="o">()</span>
            <span class="o">.</span><span class="na">getTransactionManager</span><span class="o">()</span>
            <span class="o">.</span><span class="na">requiresNew</span><span class="o">(()</span> <span class="o">-&gt;</span>
                    <span class="n">DomaDaoRepository</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">ProjectDao</span><span class="o">.</span><span class="na">class</span><span class="o">).</span><span class="na">insert</span><span class="o">(</span><span class="n">project</span><span class="o">);</span>

    <span class="k">return</span> <span class="k">new</span> <span class="n">HttpResponse</span><span class="o">(</span><span class="s">&quot;redirect://complete&quot;</span><span class="o">);</span>
<span class="o">}</span>
</pre></div>
</div>
</dd>
</dl>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">As SingletonConfig annotation and config attribute of Dao annotation has been deprecated from Doma 2.44.0, the implementation method has changed from the information provided prior to Doma 2.44.0.
For more information, see <a class="reference internal" href="#migration-doma2-44-0"><span>Migrating from Doma 2.44.0</span></a> .</p>
</div>
</div>
<div class="section" id="use-doma-and-nablarch-database-access-together">
<h2><a class="toc-backref" href="#id12">Use Doma and Nablarch database access together</a><a class="headerlink" href="#use-doma-and-nablarch-database-access-together" title="Permalink to this headline">¶</a></h2>
<p>Even if Doma is used for database access, you may want to use database access <a class="reference internal" href="../application_framework/libraries/database_management.html#database-management"><span>provided by Nablarch</span></a>.
For example, when using <a class="reference internal" href="../application_framework/libraries/mail.html#mail"><span>the mail sending library</span></a>. (<a class="reference internal" href="../application_framework/libraries/mail.html#mail-request"><span>Database is used in mail send request</span></a>.)</p>
<p>To solve this problem, a function is provided by the database access processing of Nablarch that can use the same transaction (database connection) as Doma.</p>
<dl class="docutils">
<dt>Usage procedure</dt>
<dd><p class="first">Add the following definition to the component configuration file.
As a result, database access of Nablarch is automatically executed under the transaction of Doma.</p>
<ul class="simple">
<li>Define <a class="reference external" href="https://nablarch.github.io/docs/6u3/javadoc/nablarch/integration/doma/ConnectionFactoryFromDomaConnection.html" title="nablarch.integration.doma.ConnectionFactoryFromDomaConnection">ConnectionFactoryFromDomaConnection</a> in the component configuration file.
The component name should be <code class="docutils literal"><span class="pre">connectionFactoryFromDoma</span></code>.</li>
<li>Configure ConnectionFactoryFromDomaConnection in the listener that controls the transaction of Doma for Jakarta Batch.</li>
</ul>
<div class="last highlight-xml"><div class="highlight"><pre><span></span><span class="c">&lt;!--  Component name is connectionFactoryFromDoma  --&gt;</span>
<span class="nt">&lt;component</span> <span class="na">name=</span><span class="s">&quot;connectionFactoryFromDoma&quot;</span>
    <span class="na">class=</span><span class="s">&quot;nablarch.integration.doma.ConnectionFactoryFromDomaConnection&quot;</span><span class="nt">&gt;</span>

    <span class="c">&lt;!--  Configuration of properties are omitted  --&gt;</span>

<span class="nt">&lt;/component&gt;</span>

<span class="c">&lt;!--</span>
<span class="c">When using in Jakarta Batch-compliant batch application configure connectionFactoryFromDoma defined</span>
<span class="c">above in the listener that controls the transaction of Doma.</span>
<span class="c">--&gt;</span>
<span class="nt">&lt;component</span> <span class="na">class=</span><span class="s">&quot;nablarch.integration.doma.batch.ee.listener.DomaTransactionItemWriteListener&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;connectionFactory&quot;</span> <span class="na">ref=</span><span class="s">&quot;connectionFactoryFromDoma&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/component&gt;</span>

<span class="nt">&lt;component</span> <span class="na">class=</span><span class="s">&quot;nablarch.integration.doma.batch.ee.listener.DomaTransactionStepListener&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;connectionFactory&quot;</span> <span class="na">ref=</span><span class="s">&quot;connectionFactoryFromDoma&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/component&gt;</span>
</pre></div>
</div>
</dd>
</dl>
</div>
<div class="section" id="switch-logger">
<h2><a class="toc-backref" href="#id13">Switch logger</a><a class="headerlink" href="#switch-logger" title="Permalink to this headline">¶</a></h2>
<p>This adapter provides  <a class="reference external" href="https://nablarch.github.io/docs/6u3/javadoc/nablarch/integration/doma/NablarchJdbcLogger.html" title="nablarch.integration.doma.NablarchJdbcLogger">NablarchJdbcLogger</a>, which uses Nablarch logger as an implementation of the logger used by Doma.
Although  <a class="reference external" href="https://nablarch.github.io/docs/6u3/javadoc/nablarch/integration/doma/NablarchJdbcLogger.html" title="nablarch.integration.doma.NablarchJdbcLogger">NablarchJdbcLogger</a> is used by default, if the logger is to be replaced with another one, it must be configured in the component definition file.</p>
<p>The configuration example when <code class="docutils literal"><span class="pre">org.seasar.doma.jdbc.UtilLoggingJdbcLogger</span></code> is used is shown below.</p>
<dl class="docutils">
<dt>Point</dt>
<dd><ul class="first last simple">
<li>The defined logger must be an implementation class of <code class="docutils literal"><span class="pre">org.seasar.doma.jdbc.JdbcLogger</span></code></li>
<li>The component name of the logger should be <code class="docutils literal"><span class="pre">domaJdbcLogger</span></code></li>
</ul>
</dd>
</dl>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;component</span> <span class="na">name=</span><span class="s">&quot;domaJdbcLogger&quot;</span> <span class="na">class=</span><span class="s">&quot;org.seasar.doma.jdbc.UtilLoggingJdbcLogger&quot;</span>  <span class="nt">/&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="perform-configuration-for-java-sql-statement">
<h2><a class="toc-backref" href="#id14">Perform configuration for java.sql.Statement</a><a class="headerlink" href="#perform-configuration-for-java-sql-statement" title="Permalink to this headline">¶</a></h2>
<p>You may want to configure items related to <code class="docutils literal"><span class="pre">java.sql.Statement</span></code> such as fetch size and query timeout for the whole project.</p>
<p>In such a case, configure <a class="reference external" href="https://nablarch.github.io/docs/6u3/javadoc/nablarch/integration/doma/DomaStatementProperties.html" title="nablarch.integration.doma.DomaStatementProperties">DomaStatementProperties</a> in the component configuration file.</p>
<p>Items that can be configured include the following.</p>
<ul class="simple">
<li>Maximum number of rows</li>
<li>Fetch size</li>
<li>Query timeout (seconds)</li>
<li>Batch size</li>
</ul>
<p>The configuration example shown below.</p>
<dl class="docutils">
<dt>Point</dt>
<dd><ul class="first last simple">
<li>The component name should be <code class="docutils literal"><span class="pre">domaStatementProperties</span></code></li>
</ul>
</dd>
</dl>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;component</span> <span class="na">class=</span><span class="s">&quot;nablarch.integration.doma.DomaStatementProperties&quot;</span> <span class="na">name=</span><span class="s">&quot;domaStatementProperties&quot;</span><span class="nt">&gt;</span>
  <span class="c">&lt;!-- Configure the limit for maximum number of rows to 1000 --&gt;</span>
  <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;maxRows&quot;</span> <span class="na">value=</span><span class="s">&quot;1000&quot;</span> <span class="nt">/&gt;</span>
  <span class="c">&lt;!-- Configure the fetch size to 200 rows --&gt;</span>
  <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;fetchSize&quot;</span> <span class="na">value=</span><span class="s">&quot;200&quot;</span> <span class="nt">/&gt;</span>
  <span class="c">&lt;!-- Configure query timeout to 30 seconds --&gt;</span>
  <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;queryTimeout&quot;</span> <span class="na">value=</span><span class="s">&quot;30&quot;</span> <span class="nt">/&gt;</span>
  <span class="c">&lt;!-- Configure batch size to 400 --&gt;</span>
  <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;batchSize&quot;</span> <span class="na">value=</span><span class="s">&quot;400&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/component&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="migrating-from-doma-2-44-0">
<span id="migration-doma2-44-0"></span><h2><a class="toc-backref" href="#id15">Migrating from Doma 2.44.0</a><a class="headerlink" href="#migrating-from-doma-2-44-0" title="Permalink to this headline">¶</a></h2>
<p>As the config attribute of the Dao annotation and the SingletonConfig annotation have been deprecated from <a class="reference external" href="https://github.com/domaframework/doma/releases/tag/2.44.0">Doma 2.44.0(external site)</a> , Nablarch has also added an API and changed the implementation method from what was previously provided.</p>
<p>Implementations using the config attribute of the Dao annotation and the SingletonConfig annotation will continue to work, but it is recommended to migrate the implementation method to match the changes in Doma.</p>
<p>Here we explain the comparison with the implementation method that was provided on Nablarch before Doma 2.44.0.</p>
<p>Note that the implementation method provided before Doma 2.44.0 will continue to operate in the same way.</p>
<div class="section" id="if-you-are-using-the-basic-implementation-using-domaconfig">
<h3><a class="toc-backref" href="#id16">If you are using the basic implementation using DomaConfig</a><a class="headerlink" href="#if-you-are-using-the-basic-implementation-using-domaconfig" title="Permalink to this headline">¶</a></h3>
<p>An implementation example in which DomaConfig is specified in the config attribute of Dao annotation is shown below.</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="c1">// Definition of Dao</span>
<span class="nd">@Dao</span><span class="o">(</span><span class="n">config</span> <span class="o">=</span> <span class="n">DomaConfig</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>  <span class="cm">/* Specify the config attribute */</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">ProjectDao</span> <span class="o">{</span>
    <span class="c1">// Omitted</span>
<span class="o">}</span>

<span class="c1">// Example of implementation using Dao</span>
<span class="nd">@Transactional</span>
<span class="kd">public</span> <span class="n">HttpResponse</span> <span class="nf">create</span><span class="o">(</span><span class="kd">final</span> <span class="n">HttpRequest</span> <span class="n">request</span><span class="o">,</span> <span class="kd">final</span> <span class="n">ExecutionContext</span> <span class="n">context</span><span class="o">)</span> <span class="o">{</span>
    <span class="kd">final</span> <span class="n">Project</span> <span class="n">project</span> <span class="o">=</span> <span class="n">SessionUtil</span><span class="o">.</span><span class="na">delete</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="s">&quot;project&quot;</span><span class="o">);</span>

    <span class="n">DomaDaoRepository</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">ProjectDao</span><span class="o">.</span><span class="na">class</span><span class="o">).</span><span class="na">insert</span><span class="o">(</span><span class="n">project</span><span class="o">);</span>

    <span class="k">return</span> <span class="k">new</span> <span class="n">HttpResponse</span><span class="o">(</span><span class="s">&quot;redirect://complete&quot;</span><span class="o">);</span>
<span class="o">}</span>
</pre></div>
</div>
<p>This is equivalent to the following implementation.</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="c1">// Definition of Dao</span>
<span class="nd">@Dao</span>  <span class="cm">/* Remove the config attribute specification */</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">ProjectDao</span> <span class="o">{</span>
    <span class="c1">// Omitted</span>
<span class="o">}</span>

<span class="c1">// Example of implementation using Dao</span>
<span class="nd">@Transactional</span>
<span class="kd">public</span> <span class="n">HttpResponse</span> <span class="nf">create</span><span class="o">(</span><span class="kd">final</span> <span class="n">HttpRequest</span> <span class="n">request</span><span class="o">,</span> <span class="kd">final</span> <span class="n">ExecutionContext</span> <span class="n">context</span><span class="o">)</span> <span class="o">{</span>
    <span class="kd">final</span> <span class="n">Project</span> <span class="n">project</span> <span class="o">=</span> <span class="n">SessionUtil</span><span class="o">.</span><span class="na">delete</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="s">&quot;project&quot;</span><span class="o">);</span>

    <span class="n">DomaDaoRepository</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">ProjectDao</span><span class="o">.</span><span class="na">class</span><span class="o">).</span><span class="na">insert</span><span class="o">(</span><span class="n">project</span><span class="o">);</span>  <span class="cm">/* No changes */</span>

    <span class="k">return</span> <span class="k">new</span> <span class="n">HttpResponse</span><span class="o">(</span><span class="s">&quot;redirect://complete&quot;</span><span class="o">);</span>
<span class="o">}</span>
</pre></div>
</div>
<p>When you use a Dao that does not specify the config attribute of the Dao annotation and obtain the Dao implementation class using <a class="reference external" href="https://nablarch.github.io/docs/6u3/javadoc/nablarch/integration/doma/DomaDaoRepository.html#get(java.lang.Class)" title="nablarch.integration.doma.DomaDaoRepository.get(java.lang.Class)">DomaDaoRepository#get</a> , the Dao implementation class is constructed using <a class="reference external" href="https://nablarch.github.io/docs/6u3/javadoc/nablarch/integration/doma/DomaConfig.html" title="nablarch.integration.doma.DomaConfig">DomaConfig</a> .</p>
</div>
<div class="section" id="if-you-are-using-domatransactionnotsupportedconfig-for-lazy-loading">
<h3><a class="toc-backref" href="#id17">If you are using DomaTransactionNotSupportedConfig for lazy loading</a><a class="headerlink" href="#if-you-are-using-domatransactionnotsupportedconfig-for-lazy-loading" title="Permalink to this headline">¶</a></h3>
<p>An implementation example using <a class="reference external" href="https://nablarch.github.io/docs/6u3/javadoc/nablarch/integration/doma/DomaTransactionNotSupportedConfig.html" title="nablarch.integration.doma.DomaTransactionNotSupportedConfig">DomaTransactionNotSupportedConfig</a> is shown below to support lazy loading in a batch application compliant with Jakarta Batch.</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="c1">// Definition of Dao</span>
<span class="nd">@Dao</span><span class="o">(</span><span class="n">config</span> <span class="o">=</span> <span class="n">DomaTransactionNotSupportedConfig</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>  <span class="cm">/* Specify the config attribute */</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">ProjectDao</span> <span class="o">{</span>

    <span class="nd">@Select</span><span class="o">(</span><span class="n">strategy</span> <span class="o">=</span> <span class="n">SelectType</span><span class="o">.</span><span class="na">RETURN</span><span class="o">)</span>
    <span class="n">Stream</span><span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span> <span class="nf">search</span><span class="o">();</span>
<span class="o">}</span>

<span class="c1">// Example of implementation using Dao</span>
<span class="nd">@Dependent</span>
<span class="nd">@Named</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ProjectReader</span> <span class="kd">extends</span> <span class="n">AbstractItemReader</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="n">Iterator</span><span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span> <span class="n">iterator</span><span class="o">;</span>

    <span class="kd">private</span> <span class="n">Stream</span><span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span> <span class="n">stream</span><span class="o">;</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">open</span><span class="o">(</span><span class="n">Serializable</span> <span class="n">checkpoint</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="cm">/* Specify only the Dao interface to DomaDaoRepository#get */</span>
        <span class="kd">final</span> <span class="n">ProjectDao</span> <span class="n">dao</span> <span class="o">=</span> <span class="n">DomaDaoRepository</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">ProjectDao</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="n">stream</span> <span class="o">=</span> <span class="n">dao</span><span class="o">.</span><span class="na">search</span><span class="o">();</span>
        <span class="n">iterator</span> <span class="o">=</span> <span class="n">stream</span><span class="o">.</span><span class="na">iterator</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="c1">// Omitted</span>
<span class="o">}</span>
</pre></div>
</div>
<p>This is equivalent to the following implementation.</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="c1">// Definition of Dao</span>
<span class="nd">@Dao</span>  <span class="cm">/* Remove the config attribute specification */</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">ProjectDao</span> <span class="o">{</span>

    <span class="nd">@Select</span><span class="o">(</span><span class="n">strategy</span> <span class="o">=</span> <span class="n">SelectType</span><span class="o">.</span><span class="na">RETURN</span><span class="o">)</span>
    <span class="n">Stream</span><span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span> <span class="nf">search</span><span class="o">();</span>
<span class="o">}</span>

<span class="c1">// Example of implementation using Dao</span>
<span class="nd">@Dependent</span>
<span class="nd">@Named</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ProjectReader</span> <span class="kd">extends</span> <span class="n">AbstractItemReader</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="n">Iterator</span><span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span> <span class="n">iterator</span><span class="o">;</span>

    <span class="kd">private</span> <span class="n">Stream</span><span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span> <span class="n">stream</span><span class="o">;</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">open</span><span class="o">(</span><span class="n">Serializable</span> <span class="n">checkpoint</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="cm">/* Specify DomaTransactionNotSupportedConfig.class as the second argument of DomaDaoRepository#get */</span>
        <span class="kd">final</span> <span class="n">ProjectDao</span> <span class="n">dao</span> <span class="o">=</span> <span class="n">DomaDaoRepository</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">ProjectDao</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">DomaTransactionNotSupportedConfig</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="n">stream</span> <span class="o">=</span> <span class="n">dao</span><span class="o">.</span><span class="na">search</span><span class="o">();</span>
        <span class="n">iterator</span> <span class="o">=</span> <span class="n">stream</span><span class="o">.</span><span class="na">iterator</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="c1">// Omitted</span>
<span class="o">}</span>
</pre></div>
</div>
<p>When <a class="reference external" href="https://nablarch.github.io/docs/6u3/javadoc/nablarch/integration/doma/DomaDaoRepository.html#get(java.lang.Class,java.lang.Class)" title="nablarch.integration.doma.DomaDaoRepository.get(java.lang.Class,java.lang.Class)">DomaDaoRepository#get(java.lang.Class,java.lang.Class)</a> is called using a Dao that does not specify the config attribute in the Dao annotation, the implementation class of the Dao is constructed using the Config specified in the second argument.</p>
</div>
<div class="section" id="if-you-have-created-your-own-config-class">
<h3><a class="toc-backref" href="#id18">If you have created your own Config class</a><a class="headerlink" href="#if-you-have-created-your-own-config-class" title="Permalink to this headline">¶</a></h3>
<p>An example of creating and implementing a unique Config class for reasons such as accessing multiple databases is shown below.</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="c1">// Defining the Config class</span>
<span class="nd">@SingletonConfig</span>  <span class="cm">/* Set the SingletonConfig annotation */</span>
<span class="kd">public</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">CustomConfig</span> <span class="kd">implements</span> <span class="n">Config</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="nf">CustomConfig</span><span class="o">()</span> <span class="o">{</span>  <span class="cm">/* Make it a private constructor */</span>
        <span class="c1">// Omitted</span>
    <span class="o">}</span>

    <span class="c1">// Omitted</span>
<span class="o">}</span>

<span class="c1">// Definition of Dao</span>
<span class="nd">@Dao</span><span class="o">(</span><span class="n">config</span> <span class="o">=</span> <span class="n">CustomConfig</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>  <span class="cm">/* Specify the Config class you created in the config attribute */</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">ProjectDao</span> <span class="o">{</span>
    <span class="c1">// Omitted</span>
<span class="o">}</span>

<span class="c1">// Example of implementation using Dao</span>
<span class="kd">public</span> <span class="n">HttpResponse</span> <span class="nf">create</span><span class="o">(</span><span class="kd">final</span> <span class="n">HttpRequest</span> <span class="n">request</span><span class="o">,</span> <span class="kd">final</span> <span class="n">ExecutionContext</span> <span class="n">context</span><span class="o">)</span> <span class="o">{</span>
    <span class="kd">final</span> <span class="n">Project</span> <span class="n">project</span> <span class="o">=</span> <span class="n">SessionUtil</span><span class="o">.</span><span class="na">delete</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="s">&quot;project&quot;</span><span class="o">);</span>

    <span class="n">CustomConfig</span><span class="o">.</span><span class="na">singleton</span><span class="o">()</span>
            <span class="o">.</span><span class="na">getTransactionManager</span><span class="o">()</span>
            <span class="o">.</span><span class="na">requiresNew</span><span class="o">(()</span> <span class="o">-&gt;</span>
                    <span class="cm">/* Specify only the Dao interface to DomaDaoRepository#get */</span>
                    <span class="n">DomaDaoRepository</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">ProjectDao</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

    <span class="k">return</span> <span class="k">new</span> <span class="n">HttpResponse</span><span class="o">(</span><span class="s">&quot;redirect://complete&quot;</span><span class="o">);</span>
<span class="o">}</span>
</pre></div>
</div>
<p>This is equivalent to the following implementation.</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="c1">// Defining the Config class</span>
<span class="cm">/* Remove SingletonConfig annotation */</span>
<span class="kd">public</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">CustomConfig</span> <span class="kd">implements</span> <span class="n">Config</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="nf">CustomConfig</span><span class="o">()</span> <span class="o">{</span>  <span class="cm">/* Change to public constructor with no arguments */</span>
        <span class="c1">// Omitted</span>
    <span class="o">}</span>

    <span class="c1">// Omitted</span>
<span class="o">}</span>

<span class="c1">// Definition of Dao</span>
<span class="nd">@Dao</span>  <span class="cm">/* Remove the config attribute specification */</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">ProjectDao</span> <span class="o">{</span>
    <span class="c1">// Omitted</span>
<span class="o">}</span>

<span class="c1">// Example of implementation using Dao</span>
<span class="kd">public</span> <span class="n">HttpResponse</span> <span class="nf">create</span><span class="o">(</span><span class="kd">final</span> <span class="n">HttpRequest</span> <span class="n">request</span><span class="o">,</span> <span class="kd">final</span> <span class="n">ExecutionContext</span> <span class="n">context</span><span class="o">)</span> <span class="o">{</span>
    <span class="kd">final</span> <span class="n">Project</span> <span class="n">project</span> <span class="o">=</span> <span class="n">SessionUtil</span><span class="o">.</span><span class="na">delete</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="s">&quot;project&quot;</span><span class="o">);</span>

    <span class="n">CustomConfig</span><span class="o">.</span><span class="na">singleton</span><span class="o">()</span>
            <span class="o">.</span><span class="na">getTransactionManager</span><span class="o">()</span>
            <span class="o">.</span><span class="na">requiresNew</span><span class="o">(()</span> <span class="o">-&gt;</span>
                    <span class="cm">/* Specify the Class of the Config you created as the second argument of DomaDaoRepository#get */</span>
                    <span class="n">DomaDaoRepository</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">ProjectDao</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">CustomConfig</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

    <span class="k">return</span> <span class="k">new</span> <span class="n">HttpResponse</span><span class="o">(</span><span class="s">&quot;redirect://complete&quot;</span><span class="o">);</span>
<span class="o">}</span>
</pre></div>
</div>
<p>When <a class="reference external" href="https://nablarch.github.io/docs/6u3/javadoc/nablarch/integration/doma/DomaDaoRepository.html#get(java.lang.Class,java.lang.Class)" title="nablarch.integration.doma.DomaDaoRepository.get(java.lang.Class,java.lang.Class)">DomaDaoRepository#get(java.lang.Class,java.lang.Class)</a> is called using a Dao that does not specify the config attribute in the Dao annotation, the implementation class of the Dao is constructed using the Config specified in the second argument.</p>
</div>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>

    <hr/>

    <div role="contentinfo">
        <p>
            &copy; Copyright 2010-2025, TIS Inc.
        </p>
    </div>
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'6u3',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: ''
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>
      <script type="text/javascript" src="../../_static/custom.js"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>