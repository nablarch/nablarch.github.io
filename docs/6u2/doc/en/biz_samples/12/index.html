


<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv='content-language' content='ja'>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Authentication sample using OIDC ID token &mdash; ∇Nablarch  6u2 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  

  

  
  <link rel="canonical" href="https://nablarch.github.io/docs/LATEST/doc/biz_samples/12/index.html" />
  
    <link rel="top" title="∇Nablarch  6u2 documentation" href="../../index.html"/>
        <link rel="up" title="Implementation Examples Per Use Cases" href="../index.html"/>
        <link rel="next" title="Sample Request/Response Log Output Using Logbook" href="../13/index.html"/>
        <link rel="prev" title="Messaging Platform Test Simulator Sample" href="../11/index.html"/>

<script defer data-domain="nablarch.github.io,all.fintan" src=https://plausible.io/js/script.js></script>


  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          
  
  <a href="../../index.html" id="sidebar-title" class="icon"> ∇Nablarch 
  

  
    <div id="sidebar-version">Version: 6u2</div>
  </a>

  <div role="search">
    <form id="google-search-form" class="wy-form" method="get" action="https://www.google.co.jp/search">
      <input type="text" name="text" placeholder="Search docs on google" id="text"/>
      <input type="hidden" name="q" id="q"/>
    </form>
  </div>
    
    

        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
  
  
    <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../about_nablarch/index.html">What is the Nablarch?</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../about_nablarch/concept.html">Nablarch Concept</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../about_nablarch/concept.html#robustness">Robustness</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../about_nablarch/concept.html#testability">Testability</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../about_nablarch/concept.html#ready-to-use">Ready-to-Use</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../about_nablarch/mvn_module.html">Module List of Nablarch</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../about_nablarch/license.html">Information on Nablarch License</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../application_framework/index.html">Nablarch Application Framework</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../application_framework/application_framework/index.html">Application Framework</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../application_framework/application_framework/nablarch/index.html">What is Nablarch Application Framework?</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../application_framework/application_framework/web/index.html">Web Application</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../application_framework/application_framework/web_service/index.html">Web Service</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../application_framework/application_framework/batch/index.html">Batch Application</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../application_framework/application_framework/messaging/index.html">Messaging</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../application_framework/application_framework/handlers/index.html">Standard Handler Provided by Nablarch</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../application_framework/application_framework/libraries/index.html">Libraries Provided by Nablarch</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../application_framework/application_framework/blank_project/index.html">Blank Project</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../application_framework/application_framework/setting_guide/index.html">Nablarch Application Framework Configuration Guide</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../application_framework/application_framework/configuration/index.html">Default Configuration List</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../application_framework/application_framework/cloud_native/index.html">Nablarch Cloud Native Support</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../application_framework/adaptors/index.html">Adaptor</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../application_framework/adaptors/log_adaptor.html">log Adapter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../application_framework/adaptors/router_adaptor.html">Routing Adapter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../application_framework/adaptors/webspheremq_adaptor.html">IBM MQ Adapter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../application_framework/adaptors/jaxrs_adaptor.html">Jakarta RESTful Web Services Adapter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../application_framework/adaptors/doma_adaptor.html">Doma Adapter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../application_framework/adaptors/jsr310_adaptor.html">JSR310(Date and Time API)Adapter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../application_framework/adaptors/mail_sender_freemarker_adaptor.html">E-mail FreeMarker Adapter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../application_framework/adaptors/mail_sender_thymeleaf_adaptor.html">E-mail Thymeleaf Adapter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../application_framework/adaptors/mail_sender_velocity_adaptor.html">E-mail Velocity Adapter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../application_framework/adaptors/web_thymeleaf_adaptor.html">Web Application Thymeleaf Adapter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../application_framework/adaptors/lettuce_adaptor.html">Lettuce Adapter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../application_framework/adaptors/slf4j_adaptor.html">SLF4J Adapter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../application_framework/adaptors/micrometer_adaptor.html">Micrometer Adapter</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../development_tools/index.html">Nablarch development tools</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../development_tools/java_static_analysis/index.html">Efficient Java Static Checks</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../development_tools/java_static_analysis/index.html#run-inspection">Run inspection</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../development_tools/java_static_analysis/index.html#unify-the-format">Unify the format</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../development_tools/java_static_analysis/index.html#check-if-unauthorized-apis-are-being-used">Check if unauthorized APIs are being used</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../development_tools/testing_framework/index.html">Testing framework</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../development_tools/testing_framework/guide/development_guide/05_UnitTestGuide/index.html">How to Execute Unit Tests</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../development_tools/testing_framework/guide/development_guide/06_TestFWGuide/index.html">How to Use the Automated Test Framework</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../development_tools/testing_framework/guide/development_guide/08_TestTools/index.html">Tools Used in the Programming Phase</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../development_tools/toolbox/index.html">Useful Tools When Developing Applications</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../development_tools/toolbox/JspStaticAnalysis/index.html">Jakarta Server Pages Static Analysis Tool</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../development_tools/toolbox/SqlExecutor/SqlExecutor.html">Nablarch SQL Executor</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../examples/index.html">Example</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../examples/index.html#how-to-run-example">How to Run Example</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../examples/index.html#procedure-to-build-the-environment">Procedure to build the environment</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../examples/index.html#procedure-to-execute">Procedure to execute</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../examples/index.html#running-on-java-21">Running on Java 21</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../examples/index.html#list-of-example">List of Example</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../examples/index.html#web-application">Web application</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../examples/index.html#web-service">Web Service</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../examples/index.html#batch-application">Batch Application</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../examples/index.html#messaging">Messaging</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Implementation Examples Per Use Cases</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../01/index.html">Sample Password Encryption Function Using Database</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../01/0101_PBKDF2PasswordEncryptor.html">Sample Password Encryption Function Using PBKDF2</a></li>
<li class="toctree-l3"><a class="reference internal" href="../01/index.html#delivery-package">Delivery package</a></li>
<li class="toctree-l3"><a class="reference internal" href="../01/index.html#summary">Summary</a></li>
<li class="toctree-l3"><a class="reference internal" href="../01/index.html#structure">Structure</a></li>
<li class="toctree-l3"><a class="reference internal" href="../01/index.html#how-to-use">How to Use</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../03/index.html">Display a List of Search Results</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../03/index.html#delivery-package">Delivery package</a></li>
<li class="toctree-l3"><a class="reference internal" href="../03/index.html#summary">Summary</a></li>
<li class="toctree-l3"><a class="reference internal" href="../03/index.html#structure">Structure</a></li>
<li class="toctree-l3"><a class="reference internal" href="../03/index.html#universaldao-class">UniversalDao class</a></li>
<li class="toctree-l3"><a class="reference internal" href="../03/index.html#listsearchinfo-class">ListSearchInfo class</a></li>
<li class="toctree-l3"><a class="reference internal" href="../03/index.html#pagination-class">Pagination class</a></li>
<li class="toctree-l3"><a class="reference internal" href="../03/index.html#entitylist-class">EntityList class</a></li>
<li class="toctree-l3"><a class="reference internal" href="../03/index.html#listsearchresult-tag">listSearchResult tag</a></li>
<li class="toctree-l3"><a class="reference internal" href="../03/index.html#how-to-import-a-sample-implementation-tag-file-into-the-business-application">How to import a sample implementation (tag file) into the business application</a></li>
<li class="toctree-l3"><a class="reference internal" href="../03/index.html#tag-reference">Tag Reference</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../04/index.html">Extended Formatter Functions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../04/0401_ExtendedDataFormatter.html">Data Formatter Expansion</a></li>
<li class="toctree-l3"><a class="reference internal" href="../04/0402_ExtendedFieldType.html">Field Type Expansion in the Data Formatter Function</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../05/index.html">Sample File Management Function Using Database</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../05/index.html#summary">Summary</a></li>
<li class="toctree-l3"><a class="reference internal" href="../05/index.html#functions">Functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../05/index.html#structure">Structure</a></li>
<li class="toctree-l3"><a class="reference internal" href="../05/index.html#how-to-use">How to Use</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../08/index.html">Sample of HTML Email Send Function</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../08/index.html#summary">Summary</a></li>
<li class="toctree-l3"><a class="reference internal" href="../08/index.html#request">Request</a></li>
<li class="toctree-l3"><a class="reference internal" href="../08/index.html#structure">Structure</a></li>
<li class="toctree-l3"><a class="reference internal" href="../08/index.html#implementation-examples">Implementation examples</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../09/index.html">How to Use a Sample to Send a Digitally Signed Email Using Bouncycastle</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../09/index.html#environment-preparation">Environment preparation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../09/index.html#structure-of-digitally-signed-email-send-function">Structure of digitally signed email send function</a></li>
<li class="toctree-l3"><a class="reference internal" href="../09/index.html#preparation-of-configuration-file">Preparation of configuration file</a></li>
<li class="toctree-l3"><a class="reference internal" href="../09/index.html#execution">Execution</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../10/index.html">How to Use the Log Aggregation Sample</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../10/index.html#list-of-samples-provided">List of samples provided</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../11/index.html">Messaging Platform Test Simulator Sample</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../11/index.html#uses">Uses</a></li>
<li class="toctree-l3"><a class="reference internal" href="../11/index.html#features">Features</a></li>
<li class="toctree-l3"><a class="reference internal" href="../11/index.html#request">Request</a></li>
<li class="toctree-l3"><a class="reference internal" href="../11/index.html#how-to-use">How to use</a></li>
<li class="toctree-l3"><a class="reference internal" href="../11/index.html#expansion-example">Expansion example</a></li>
</ul>
</li>
<li class="toctree-l2 current"><a class="current reference internal" href="">Authentication sample using OIDC ID token</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#delivery-package">Delivery package</a></li>
<li class="toctree-l3"><a class="reference internal" href="#summary">Summary</a></li>
<li class="toctree-l3"><a class="reference internal" href="#structure">Structure</a></li>
<li class="toctree-l3"><a class="reference internal" href="#how-to-use">How to Use</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../13/index.html">Sample Request/Response Log Output Using Logbook</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../13/index.html#summary">Summary</a></li>
<li class="toctree-l3"><a class="reference internal" href="../13/index.html#how-to-use">How to Use</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../external_contents/index.html">Useful content for development in Nablarch</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../external_contents/index.html#nablarch-system-development-guide">Nablarch System Development Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../external_contents/index.html#development-standards">Development Standards</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../nablarch_api/index.html">Nablarch API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../about_nablarch/versionup_policy.html">Nablarch upgrade policy</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../about_nablarch/versionup_policy.html#release-unit">Release unit</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../about_nablarch/versionup_policy.html#types-of-upgrades">Types of upgrades</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../about_nablarch/versionup_policy.html#version-numbering-system">Version numbering system</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../about_nablarch/versionup_policy.html#backward-compatibility-policy">Backward compatibility policy</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../about_nablarch/versionup_policy.html#extent-to-which-backward-compatibility-is-maintained">Extent to which backward compatibility is maintained</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../about_nablarch/versionup_policy.html#contents-of-backward-compatibility-maintenance">Contents of backward compatibility maintenance</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../about_nablarch/versionup_policy.html#backward-compatibility-exception">Backward compatibility exception</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../migration/index.html">Nablarch 5 to 6 Migration Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../migration/index.html#major-differences-between-nablarch-5-and-6">Major differences between Nablarch 5 and 6</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../migration/index.html#supports-jakarta-ee-10">Supports Jakarta EE 10</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../migration/index.html#changed-required-java-version-to-17">Changed  required Java version to 17</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../migration/index.html#prerequisites">Prerequisites</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../migration/index.html#overview-of-migration-steps">Overview of migration steps</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../migration/index.html#details-of-migration-steps">Details of migration steps</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../migration/index.html#nablarch-version-upgrade">Nablarch version upgrade</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../migration/index.html#compatible-with-jakarta-ee">Compatible with Jakarta EE</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../migration/index.html#migration-procedure-of-jsr352-compliant-batch-application">Migration procedure of JSR352-compliant Batch Application</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../migration/index.html#what-to-do-if-an-error-occurs-during-execution">What to do if an error occurs during execution</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../migration/index.html#appendix">Appendix</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../migration/index.html#correspondence-table-between-java-ee-and-jakarta-ee-specifications">Correspondence table between Java EE and Jakarta EE specifications</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../jakarta_ee/index.html">Regarding the specification name of Jakarta EE</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../jakarta_ee/index.html#regarding-the-notation-of-acronyms">Regarding the notation of acronyms</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../jakarta_ee/index.html#regarding-features-that-have-been-renamed-in-nablarch-5-and-6">Regarding features that have been renamed in Nablarch 5 and 6</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../terms_of_use/index.html">Terms of Use</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../terms_of_use/index.html#external-transmssion-of-information">External Transmssion of Information</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../terms_of_use/index.html#purpose-of-information-use">Purpose of Information Use</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../terms_of_use/index.html#destination-of-information">Destination of information</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../terms_of_use/index.html#type-and-use-of-information">Type and use of information</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">∇Nablarch </a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../index.html">Implementation Examples Per Use Cases</a> &raquo;</li>
      
    <li>Authentication sample using OIDC ID token</li>
    <li class="wy-breadcrumbs-aside">
      <a href="https://github.com/nablarch" class="fa fa-github">GitHub</a>
    </li>
    <li class="wy-breadcrumbs-aside">
        <a href="https://nablarch.github.io/docs/LATEST/doc/index.html" class="ja">日本語</a>
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="authentication-sample-using-oidc-id-token">
<h1>Authentication sample using OIDC ID token<a class="headerlink" href="#authentication-sample-using-oidc-id-token" title="Permalink to this headline">¶</a></h1>
<div class="section" id="delivery-package">
<h2>Delivery package<a class="headerlink" href="#delivery-package" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://github.com/nablarch/nablarch-biz-sample-all/tree/master/nablarch-oidc">Source code</a></p>
<p>The sample is provided in the following package.</p>
<blockquote>
<div><em>please.change.me.</em><strong>common.oidc.verification</strong></div></blockquote>
</div>
<div class="section" id="summary">
<h2>Summary<a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h2>
<p>In this sample, authentication is performed using an ID token that can be obtained from OpenID  (hereafter referred to as &#8220;OIDC&#8221;).</p>
<p>Although the method of acquiring ID token and the implementation location may vary depending on the application configuration, the following configuration is assumed in this sample.</p>
<ul class="simple">
<li>Running a RESTful web services application with Nablarch on back-end.</li>
<li>ID token are acquired on the front-end (SPA, mobile app, etc.) and then sent to back-end.</li>
<li>Establish login session upon successful authentication and stateful session management after authentication.</li>
<li>Authentication processes are implemented in business action.</li>
</ul>
<p>OIDC is supported by a variety of services, but this sample deals with ID token issued by the following services.</p>
<ul class="simple">
<li>Amazon Web Services（hereafter referred to as &#8220;AWS&#8221;）<ul>
<li><a class="reference external" href="https://aws.amazon.com/cognito/">Amazon Cognito User pool</a> (hereafter referred to as &#8220;User pool&#8221;)</li>
</ul>
</li>
<li>Microsoft Azure（hereafter referred to as &#8220;Azure&#8221;）<ul>
<li><a class="reference external" href="https://learn.microsoft.com/en-us/azure/active-directory-b2c/">Azure Active Directory B2C</a> （hereafter referred to as &#8220;ADB2C&#8221;）</li>
</ul>
</li>
</ul>
<p>Within the offering packages, the packages are further divided by targeted services.</p>
<p>Sample handling ID token issued by User pool.</p>
<blockquote>
<div><em>please.change.me.common.oidc.verification.</em><strong>cognito</strong></div></blockquote>
<p>Samples of handling ID token issued by ADB2C.</p>
<blockquote>
<div><em>please.change.me.common.oidc.verification.</em><strong>adb2c</strong></div></blockquote>
<p>Since the concept is the same for all packages, this page is based on the sample cognito package.
When using the adb2c package, replace it with the corresponding component as appropriate.</p>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">This sample is implemented according to the specifications of User pool and ADB2C as of September 2024.
Be sure to check the latest specifications of the services you use and customize accordingly.</p>
</div>
<div class="section" id="scope-of-this-sample">
<h3>Scope of this sample<a class="headerlink" href="#scope-of-this-sample" title="Permalink to this headline">¶</a></h3>
<p>The overall process flow and the scope addressed in this sample are described below.</p>
<img alt="../../_images/nablarch-example-oidc-scope.drawio.png" src="../../_images/nablarch-example-oidc-scope.drawio.png" />
<p>This sample deals only with back-end application that use Nablarch, and does not cover how to obtain ID token for front-end application (web, mobile apps, etc.).</p>
</div>
</div>
<div class="section" id="structure">
<h2>Structure<a class="headerlink" href="#structure" title="Permalink to this headline">¶</a></h2>
<div class="section" id="class-diagram">
<h3>Class diagram<a class="headerlink" href="#class-diagram" title="Permalink to this headline">¶</a></h3>
<p>A class diagram is shown below for the classes provided in this sample.</p>
<img alt="../../_images/nablarch-example-oidc-class.drawio.png" src="../../_images/nablarch-example-oidc-class.drawio.png" />
</div>
<div class="section" id="responsibilities-of-each-class">
<h3>Responsibilities of each class<a class="headerlink" href="#responsibilities-of-each-class" title="Permalink to this headline">¶</a></h3>
<p>Responsibilities of each class are described below.</p>
<div class="section" id="interface">
<h4>Interface<a class="headerlink" href="#interface" title="Permalink to this headline">¶</a></h4>
<table border="1" class="docutils">
<colgroup>
<col width="26%" />
<col width="74%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Interface name</th>
<th class="head">Summary</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>IdTokenVerifier</td>
<td>Provide a function to verify that the ID token is valid.</td>
</tr>
<tr class="row-odd"><td>SignatureAlgorithmProvider</td>
<td>Provide an algorithm to be used for signature verification of token.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="class-component">
<h4>Class (Component)<a class="headerlink" href="#class-component" title="Permalink to this headline">¶</a></h4>
<table border="1" class="docutils">
<colgroup>
<col width="26%" />
<col width="74%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Class name</th>
<th class="head">Summary</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>CognitoIdTokenVerifier</td>
<td>Provides the ability to verify the validity of identity tokens provided by Cognito.</td>
</tr>
<tr class="row-odd"><td>CognitoSignatureAlgorithmProvider</td>
<td>Provide the algorithm used for signature verification of tokens provided by Cognito.</td>
</tr>
<tr class="row-even"><td>CognitoRSAKeyProvider</td>
<td>Provides the RSA public key used to verify token issued by Cognito.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="class-business-action">
<h4>Class（Business action）<a class="headerlink" href="#class-business-action" title="Permalink to this headline">¶</a></h4>
<table border="1" class="docutils">
<colgroup>
<col width="26%" />
<col width="74%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Class name</th>
<th class="head">Summary</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>LoginAction</td>
<td>Business Action for authentication process.</td>
</tr>
<tr class="row-odd"><td>LoginRequestForm</td>
<td>Form to store authentication request information.</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="section" id="how-to-use">
<h2>How to Use<a class="headerlink" href="#how-to-use" title="Permalink to this headline">¶</a></h2>
<div class="section" id="adding-dependency-libraries">
<h3>Adding Dependency Libraries<a class="headerlink" href="#adding-dependency-libraries" title="Permalink to this headline">¶</a></h3>
<p>ID token are created in the format of JSON Web Tokens (hereafter referred to as &#8220;JWT&#8221;).
Although many libraries for handling JWT are available in OSS, the sample uses &#8220;java-jwt&#8221; and &#8220;jwks-rsa-java&#8221; published by Auth0.</p>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">Libraries for working with JWT are also introduced in <a class="reference external" href="https://openid.net/developers/jwt-jws-jwe-jwk-and-jwa-implementations/">OpenID Foundation</a> and <a class="reference external" href="https://jwt.io/libraries">jwt.io</a> .</p>
</div>
<p>To make the library available, add the following dependencies to dependency settings</p>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;dependencies&gt;</span>
  ...
  <span class="c">&lt;!-- JWT Library --&gt;</span>
  <span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>com.auth0<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>java-jwt<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>4.4.0<span class="nt">&lt;/version&gt;</span>
  <span class="nt">&lt;/dependency&gt;</span>
  <span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>com.auth0<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>jwks-rsa<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>0.22.1<span class="nt">&lt;/version&gt;</span>
  <span class="nt">&lt;/dependency&gt;</span>
  ...
<span class="nt">&lt;/dependencies&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="setting-environment-dependent-values">
<h3>Setting environment dependent values<a class="headerlink" href="#setting-environment-dependent-values" title="Permalink to this headline">¶</a></h3>
<p>The process for verification of ID token is created as a component. Environment dependent values are referenced as properties to set information for accessing the service.
Therefore, the following environment dependent values should be set in the execution environment.</p>
<table border="1" class="docutils">
<colgroup>
<col width="24%" />
<col width="76%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Name</th>
<th class="head">Summary</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>aws.cognito.region</td>
<td>Region code where Cognito is created (e.g. ap-northeast-1) .</td>
</tr>
<tr class="row-odd"><td>aws.cognito.userPool.id</td>
<td>User pool ID.</td>
</tr>
<tr class="row-even"><td>aws.cognito.userPool.clientId</td>
<td>Client ID of application registered in the User pool.</td>
</tr>
</tbody>
</table>
<p>See <a class="reference internal" href="../../application_framework/application_framework/libraries/repository.html#repository-overwrite-environment-configuration"><span>Overwrite environment dependent values using system properties</span></a> and <a class="reference internal" href="../../application_framework/application_framework/libraries/repository.html#repository-overwrite-environment-configuration-by-os-env-var"><span>Overwrite environment dependent values using OS environment variables</span></a> for how to set environment dependent values.</p>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">Information required to access services may include information that should be kept confidential.
If such information is available, it is advisable to avoid writing it in files that are subject to management by a version control system to prevent its leakage to the outside.
When dealing with such information, it can be safely set as a system property or OS environment variable.</p>
</div>
</div>
<div class="section" id="component-definition-settings">
<h3>Component Definition Settings<a class="headerlink" href="#component-definition-settings" title="Permalink to this headline">¶</a></h3>
<p>The process for verification of ID token is created as a component, taking into account the use of properties and initialization at startup.
Therefore, those components are defined in the component configuration file.</p>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="c">&lt;!-- ID token verification component --&gt;</span>
<span class="nt">&lt;component</span> <span class="na">name=</span><span class="s">&quot;idTokenVerifier&quot;</span> <span class="na">class=</span><span class="s">&quot;please.change.me.common.oidc.verification.cognito.jwt.CognitoIdTokenVerifier&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;region&quot;</span> <span class="na">value=</span><span class="s">&quot;${aws.cognito.region}&quot;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;userPoolId&quot;</span> <span class="na">value=</span><span class="s">&quot;${aws.cognito.userPool.id}&quot;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;clientId&quot;</span> <span class="na">value=</span><span class="s">&quot;${aws.cognito.userPool.clientId}&quot;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;signatureAlgorithmProvider&quot;</span> <span class="na">ref=</span><span class="s">&quot;signatureAlgorithmProvider&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/component&gt;</span>
<span class="c">&lt;!-- Token Signature Verification Algorithm Provisioning Component --&gt;</span>
<span class="nt">&lt;component</span> <span class="na">name=</span><span class="s">&quot;signatureAlgorithmProvider&quot;</span> <span class="na">class=</span><span class="s">&quot;please.change.me.common.oidc.verification.cognito.jwt.CognitoSignatureAlgorithmProvider&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;rsaKeyProvider&quot;</span> <span class="na">ref=</span><span class="s">&quot;rsaKeyProvider&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/component&gt;</span>
<span class="c">&lt;!-- RSA public key provisioning component for token signature verification --&gt;</span>
<span class="nt">&lt;component</span> <span class="na">name=</span><span class="s">&quot;rsaKeyProvider&quot;</span> <span class="na">class=</span><span class="s">&quot;please.change.me.common.oidc.verification.cognito.jwt.CognitoRSAKeyProvider&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;region&quot;</span> <span class="na">value=</span><span class="s">&quot;${aws.cognito.region}&quot;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;userPoolId&quot;</span> <span class="na">value=</span><span class="s">&quot;${aws.cognito.userPool.id}&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/component&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="id-token-verification">
<h3>ID token Verification<a class="headerlink" href="#id-token-verification" title="Permalink to this headline">¶</a></h3>
<p>The component that verifies ID tokens should do so in accordance with the verification method provided by the service that issues the ID token.</p>
<p>Note that the signature verification included in the verification method requires access to the JWKS endpoint provided by the service to obtain public key information.
In the sample, in order to facilitate the implementation of tests in the local development environment for processes other than signature verification, the information necessary for signature verification shall be provided by a separate component for easy replacement.</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Provides the function to verify the validity of ID token issued by Cognito.</span>
<span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CognitoIdTokenVerifier</span> <span class="kd">implements</span> <span class="n">IdTokenVerifier</span> <span class="o">{</span>

    <span class="cm">/** Region */</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">region</span><span class="o">;</span>

    <span class="cm">/** User pool ID */</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">userPoolId</span><span class="o">;</span>

    <span class="cm">/** Client ID */</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">clientId</span><span class="o">;</span>

    <span class="cm">/** Signature Algorithm Provider */</span>
    <span class="kd">private</span> <span class="n">SignatureAlgorithmProvider</span> <span class="n">signatureAlgorithmProvider</span><span class="o">;</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">DecodedJWT</span> <span class="nf">verify</span><span class="o">(</span><span class="n">String</span> <span class="n">idToken</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">JWTVerificationException</span> <span class="o">{</span>
        <span class="c1">// Follow Cognito&#39;s guide on how to verify a token is valid.</span>
        <span class="c1">//   https://docs.aws.amazon.com/cognito/latest/developerguide/amazon-cognito-user-pools-using-tokens-verifying-a-jwt.html</span>
        <span class="c1">// Assuming that the ID token is sent immediately after acquisition on the front-end, the allowed duration of validity is 60 seconds.</span>
        <span class="n">JWTVerifier</span> <span class="n">verifier</span> <span class="o">=</span> <span class="n">JWT</span><span class="o">.</span><span class="na">require</span><span class="o">(</span><span class="n">signatureAlgorithmProvider</span><span class="o">.</span><span class="na">get</span><span class="o">())</span>
                <span class="o">.</span><span class="na">acceptExpiresAt</span><span class="o">(</span><span class="mi">60</span><span class="o">)</span>
                <span class="o">.</span><span class="na">withAudience</span><span class="o">(</span><span class="n">clientId</span><span class="o">)</span>
                <span class="o">.</span><span class="na">withIssuer</span><span class="o">(</span><span class="n">createUserPoolUrl</span><span class="o">(</span><span class="n">region</span><span class="o">,</span> <span class="n">userPoolId</span><span class="o">))</span>
                <span class="o">.</span><span class="na">withClaim</span><span class="o">(</span><span class="s">&quot;token_use&quot;</span><span class="o">,</span> <span class="s">&quot;id&quot;</span><span class="o">)</span>
                <span class="o">.</span><span class="na">build</span><span class="o">();</span>
        <span class="k">return</span> <span class="n">verifier</span><span class="o">.</span><span class="na">verify</span><span class="o">(</span><span class="n">idToken</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="cm">/**</span>
<span class="cm">     * Create a URL for the User pool.</span>
<span class="cm">     *</span>
<span class="cm">     * @param region Region</span>
<span class="cm">     * @param userPoolId User pool ID</span>
<span class="cm">     * @return URL of the User pool</span>
<span class="cm">     */</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="nf">createUserPoolUrl</span><span class="o">(</span><span class="n">String</span> <span class="n">region</span><span class="o">,</span> <span class="n">String</span> <span class="n">userPoolId</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">&quot;https://cognito-idp.&quot;</span> <span class="o">+</span> <span class="n">region</span> <span class="o">+</span> <span class="s">&quot;.amazonaws.com/&quot;</span> <span class="o">+</span> <span class="n">userPoolId</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="o">...</span>
<span class="o">}</span>
</pre></div>
</div>
<p>The Algorithm Provisioning Component for Token Signature Verification returns algorithm information according to the algorithm used by the service to sign the token.
The sample uses RSA signatures, so a public key is required, but the process of obtaining the public key information provided by the service shall be provided by a separate component.</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Provides the algorithm used for signature verification of tokens issued by Cognito.</span>
<span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CognitoSignatureAlgorithmProvider</span> <span class="kd">implements</span> <span class="n">SignatureAlgorithmProvider</span> <span class="o">{</span>

    <span class="cm">/** RSA Public Key Provider */</span>
    <span class="kd">private</span> <span class="n">RSAKeyProvider</span> <span class="n">rsaKeyProvider</span><span class="o">;</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">Algorithm</span> <span class="nf">get</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">Algorithm</span><span class="o">.</span><span class="na">RSA256</span><span class="o">(</span><span class="n">rsaKeyProvider</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="o">...</span>
<span class="o">}</span>
</pre></div>
</div>
<p>The component that provides public key information for RSA signing implements the RSAKeyProvider interface to obtain the public key information provided by the library from outside.
The component obtains the Json Web Key (hereafter referred to as &#8220;JWK&#8221;) and public key information from the Json Web Key Set (hereafter referred to as &#8220;JWKS&#8221;) endpoint published by the service.</p>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">Some services may rotate the information used for signatures at regular intervals to improve security.
In addition to rotation, information may also be changed in emergency situations such as information leaks.
To ensure signature verification, it is preferable to obtain the latest information from the published endpoints instead of using fixed values even if the key information is known in advance.</p>
</div>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Provides RSA public key used to verify token issued by Cognito.</span>
<span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CognitoRSAKeyProvider</span> <span class="kd">implements</span> <span class="n">RSAKeyProvider</span><span class="o">,</span> <span class="n">Initializable</span> <span class="o">{</span>

    <span class="cm">/** Region */</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">region</span><span class="o">;</span>

    <span class="cm">/** User pool ID */</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">userPoolId</span><span class="o">;</span>

    <span class="cm">/** JWK Provider */</span>
    <span class="kd">private</span> <span class="n">JwkProvider</span> <span class="n">provider</span><span class="o">;</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">RSAPublicKey</span> <span class="nf">getPublicKeyById</span><span class="o">(</span><span class="n">String</span> <span class="n">keyId</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">Jwk</span> <span class="n">jwk</span> <span class="o">=</span> <span class="n">provider</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">keyId</span><span class="o">);</span>
            <span class="k">return</span> <span class="o">(</span><span class="n">RSAPublicKey</span><span class="o">)</span> <span class="n">jwk</span><span class="o">.</span><span class="na">getPublicKey</span><span class="o">();</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">JwkException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">RSAPrivateKey</span> <span class="nf">getPrivateKey</span><span class="o">()</span> <span class="o">{</span>
        <span class="c1">// Only public keys can be obtained, private key acquisition is not supported.</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="n">UnsupportedOperationException</span><span class="o">(</span><span class="s">&quot;Get private key is not supported&quot;</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getPrivateKeyId</span><span class="o">()</span> <span class="o">{</span>
        <span class="c1">// Because it is undefined, null is returned according to the interface specification.</span>
        <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">initialize</span><span class="o">()</span> <span class="o">{</span>
        <span class="c1">// Create a provider to obtain public keys from JWKS endpoints published by Cognito.</span>
        <span class="c1">// This provider allows the following settings.</span>
        <span class="c1">// ・How long and how many results for each key ID (value of kid claim) should be cached.</span>
        <span class="c1">// ・How long and how many accesses to the JWKS endpoints are allowed.</span>
        <span class="c1">// ・Whether to go through a proxy server when accessing JWKS endpoints.</span>
        <span class="c1">// The following is set out here.</span>
        <span class="c1">// ・Cache up to 4 key IDs per hour (range cached for normal use even when key rotation is crossed)</span>
        <span class="c1">// ・Allow up to 10 accesses to JWKS endpoints per minute (range not reached in normal use considering cache)</span>
        <span class="c1">// ・Do not use a proxy server</span>
        <span class="k">this</span><span class="o">.</span><span class="na">provider</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JwkProviderBuilder</span><span class="o">(</span><span class="n">createUserPoolUrl</span><span class="o">(</span><span class="n">region</span><span class="o">,</span> <span class="n">userPoolId</span><span class="o">))</span>
                <span class="o">.</span><span class="na">cached</span><span class="o">(</span><span class="kc">true</span><span class="o">)</span>
                <span class="o">.</span><span class="na">cached</span><span class="o">(</span><span class="mi">4</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="n">TimeUnit</span><span class="o">.</span><span class="na">HOURS</span><span class="o">)</span>
                <span class="o">.</span><span class="na">rateLimited</span><span class="o">(</span><span class="kc">true</span><span class="o">)</span>
                <span class="o">.</span><span class="na">rateLimited</span><span class="o">(</span><span class="mi">10</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="n">TimeUnit</span><span class="o">.</span><span class="na">MINUTES</span><span class="o">)</span>
                <span class="o">.</span><span class="na">proxied</span><span class="o">(</span><span class="n">Proxy</span><span class="o">.</span><span class="na">NO_PROXY</span><span class="o">)</span>
                <span class="o">.</span><span class="na">build</span><span class="o">();</span>
    <span class="o">}</span>
</pre></div>
</div>
</div>
<div class="section" id="path-setting-of-business-action-for-authentication">
<h3>Path setting of business action for authentication<a class="headerlink" href="#path-setting-of-business-action-for-authentication" title="Permalink to this headline">¶</a></h3>
<p>In the sample, the path of the business action for authentication is set with the Path annotation of JAX-RS.</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="nd">@Path</span><span class="o">(</span><span class="s">&quot;/cognito/login&quot;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">LoginAction</span> <span class="o">{</span>
</pre></div>
</div>
<p>See <a class="reference internal" href="../../application_framework/adaptors/router_adaptor.html#router-adaptor-path-annotation"><span>Mapping in Jakarta RESTful Web Services Path Annotation</span></a> for mapping by Path annotation in JAX-RS.</p>
</div>
<div class="section" id="authentication-and-login-status-settings-on-success">
<h3>Authentication and login status settings on success<a class="headerlink" href="#authentication-and-login-status-settings-on-success" title="Permalink to this headline">¶</a></h3>
<p>The business action that implements the authentication process calls for ID token verification and establishes a login session if no abnormality is detected.
If an abnormality is detected, a response with HTTP status 401 (Unauthorized) is returned as error information.</p>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">This sample assumes the use of a CSRF token verification handler to counter CSRF (Cross Site Request Forgery).
See <a class="reference internal" href="../../application_framework/application_framework/handlers/web/csrf_token_verification_handler.html#csrf-token-verification-handler"><span>CSRF Token Verification Handler</span></a> for details on CSRF countermeasures.</p>
</div>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Authentication is performed with the ID token, and if successful, a login session is established.</span>
<span class="cm"> *</span>
<span class="cm"> * @param context Execution Context</span>
<span class="cm"> * @param form Request body</span>
<span class="cm"> */</span>
<span class="nd">@POST</span>
<span class="nd">@Consumes</span><span class="o">(</span><span class="n">MediaType</span><span class="o">.</span><span class="na">APPLICATION_JSON</span><span class="o">)</span>
<span class="nd">@Valid</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">login</span><span class="o">(</span><span class="n">ExecutionContext</span> <span class="n">context</span><span class="o">,</span> <span class="n">LoginRequestForm</span> <span class="n">form</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// Verify that the ID token is valid.</span>
    <span class="n">DecodedJWT</span> <span class="n">decodedJWT</span> <span class="o">=</span> <span class="n">verifyIdToken</span><span class="o">(</span><span class="n">form</span><span class="o">.</span><span class="na">getIdToken</span><span class="o">());</span>

    <span class="c1">// Change session ID and CSRF token after successful authentication to improve security.</span>
    <span class="n">SessionUtil</span><span class="o">.</span><span class="na">changeId</span><span class="o">(</span><span class="n">context</span><span class="o">);</span>
    <span class="n">CsrfTokenUtil</span><span class="o">.</span><span class="na">regenerateCsrfToken</span><span class="o">(</span><span class="n">context</span><span class="o">);</span>

    <span class="c1">// Identifies user information from information linked with ID token and maintains authentication status in the session.</span>
    <span class="n">String</span> <span class="n">userId</span> <span class="o">=</span> <span class="n">decodedJWT</span><span class="o">.</span><span class="na">getSubject</span><span class="o">();</span>
    <span class="n">SessionUtil</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="s">&quot;user.id&quot;</span><span class="o">,</span> <span class="n">userId</span><span class="o">);</span>
<span class="o">}</span>

<span class="cm">/**</span>
<span class="cm"> * Verify that the ID token is valid.</span>
<span class="cm"> *</span>
<span class="cm"> * @param idToken ID Token</span>
<span class="cm"> * @return Decoded ID token</span>
<span class="cm"> * @throws HttpErrorResponse If it is an invalid ID token (HTTP status code is 401)</span>
<span class="cm"> */</span>
<span class="kd">private</span> <span class="n">DecodedJWT</span> <span class="nf">verifyIdToken</span><span class="o">(</span><span class="n">String</span> <span class="n">idToken</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// Define components for validation using environment dependent values, which are retrieved from the system repository.</span>
    <span class="n">IdTokenVerifier</span> <span class="n">idTokenVerifier</span> <span class="o">=</span> <span class="n">SystemRepository</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">&quot;idTokenVerifier&quot;</span><span class="o">);</span>
    <span class="k">try</span> <span class="o">{</span>
        <span class="c1">// Verify ID token.</span>
        <span class="k">return</span> <span class="n">idTokenVerifier</span><span class="o">.</span><span class="na">verify</span><span class="o">(</span><span class="n">idToken</span><span class="o">);</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">JWTVerificationException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">LOGGER</span><span class="o">.</span><span class="na">isDebugEnabled</span><span class="o">())</span> <span class="o">{</span>
            <span class="n">LOGGER</span><span class="o">.</span><span class="na">logDebug</span><span class="o">(</span><span class="s">&quot;ID token verification failed...&quot;</span><span class="o">,</span> <span class="n">e</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="c1">// If the verification detects an abnormality, an error response with status code 401 (Unauthorized) is returned.</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="n">HttpErrorResponse</span><span class="o">(</span><span class="n">HttpResponse</span><span class="o">.</span><span class="na">Status</span><span class="o">.</span><span class="na">UNAUTHORIZED</span><span class="o">.</span><span class="na">getStatusCode</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>

    <hr/>

    <div role="contentinfo">
        <p>
            &copy; Copyright 2010-2024, TIS Inc.
        </p>
    </div>
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'6u2',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: ''
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>
      <script type="text/javascript" src="../../_static/custom.js"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>